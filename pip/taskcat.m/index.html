<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Tony Vattathil, Santiago Cardenas, Shivansh Singh">
        <link rel="canonical" href="http://aws-quickstart.github.io/taskcat/pip/taskcat.m/">
        <link rel="shortcut icon" href="../../images/favicon.png">
        
        <title>Pip Module (taskcat) - taskcat</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-99975470-1', 'auto');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">taskcat</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="active">
                        <a href="./">Pip Module (taskcat)</a>
                    </li>
                    <li >
                        <a href="../sweeper.m/">Sub Module (taskcat.sweeper)</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../sweeper.m/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/aws-quickstart/taskcat">
                                <i class="fa fa-github"></i>GitHub
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

<pre><code>&lt;title&gt;taskcat API documentation&lt;/title&gt;
&lt;meta name="description" content="" /&gt;
</code></pre>
<p><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'></p>
<style type="text/css">

<ul>
<li>{
  box-sizing: border-box;
}
/<em>! normalize.css v1.1.1 | MIT License | git.io/normalize </em>/</li>
</ul>
<p>/<em> ==========================================================================
   HTML5 display definitions
   ========================================================================== </em>/</p>
<p>/*<em>
 * Correct <code>block</code> display not defined in IE 6/7/8/9 and Firefox 3.
 </em>/</p>
<p>article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}</p>
<p>/*<em>
 * Correct <code>inline-block</code> display not defined in IE 6/7/8/9 and Firefox 3.
 </em>/</p>
<p>audio,
canvas,
video {
    display: inline-block;
    <em>display: inline;
    </em>zoom: 1;
}</p>
<p>/*<em>
 * Prevent modern browsers from displaying <code>audio</code> without controls.
 * Remove excess height in iOS 5 devices.
 </em>/</p>
<p>audio:not([controls]) {
    display: none;
    height: 0;
}</p>
<p>/*<em>
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 </em>/</p>
<p>[hidden] {
    display: none;
}</p>
<p>/<em> ==========================================================================
   Base
   ========================================================================== </em>/</p>
<p>/*<em>
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body <code>font-size</code> is set using
 *    <code>em</code> units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 </em>/</p>
<p>html {
    background: #fff; /<em> 1 </em>/
    color: #000; /<em> 2 </em>/
    font-size: 100%; /<em> 3 </em>/
    -webkit-text-size-adjust: 100%; /<em> 4 </em>/
    -ms-text-size-adjust: 100%; /<em> 4 </em>/
}</p>
<p>/*<em>
 * Address <code>font-family</code> inconsistency between <code>textarea</code> and other form
 * elements.
 </em>/</p>
<p>html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}</p>
<p>/*<em>
 * Address margins handled incorrectly in IE 6/7.
 </em>/</p>
<p>body {
    margin: 0;
}</p>
<p>/<em> ==========================================================================
   Links
   ========================================================================== </em>/</p>
<p>/*<em>
 * Address <code>outline</code> inconsistency between Chrome and other browsers.
 </em>/</p>
<p>a:focus {
    outline: thin dotted;
}</p>
<p>/*<em>
 * Improve readability when focused and also mouse hovered in all browsers.
 </em>/</p>
<p>a:active,
a:hover {
    outline: 0;
}</p>
<p>/<em> ==========================================================================
   Typography
   ========================================================================== </em>/</p>
<p>/*<em>
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within <code>section</code> and <code>article</code> in Firefox 4+, Safari 5,
 * and Chrome.
 </em>/</p>
<p>h1 {
    font-size: 2em;
    margin: 0.67em 0;
}</p>
<p>h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}</p>
<p>h3 {
    font-size: 1.17em;
    margin: 1em 0;
}</p>
<p>h4 {
    font-size: 1em;
    margin: 1.33em 0;
}</p>
<p>h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}</p>
<p>h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}</p>
<p>/*<em>
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 </em>/</p>
<p>abbr[title] {
    border-bottom: 1px dotted;
}</p>
<p>/*<em>
 * Address style set to <code>bolder</code> in Firefox 3+, Safari 4/5, and Chrome.
 </em>/</p>
<p>b,
strong {
    font-weight: bold;
}</p>
<p>blockquote {
    margin: 1em 40px;
}</p>
<p>/*<em>
 * Address styling not present in Safari 5 and Chrome.
 </em>/</p>
<p>dfn {
    font-style: italic;
}</p>
<p>/*<em>
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 </em>/</p>
<p>hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}</p>
<p>/*<em>
 * Address styling not present in IE 6/7/8/9.
 </em>/</p>
<p>mark {
    background: #ff0;
    color: #000;
}</p>
<p>/*<em>
 * Address margins set differently in IE 6/7.
 </em>/</p>
<p>p,
pre {
    margin: 1em 0;
}</p>
<p>/*<em>
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 </em>/</p>
<p>code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}</p>
<p>/*<em>
 * Improve readability of pre-formatted text in all browsers.
 </em>/</p>
<p>pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}</p>
<p>/*<em>
 * Address CSS quotes not supported in IE 6/7.
 </em>/</p>
<p>q {
    quotes: none;
}</p>
<p>/*<em>
 * Address <code>quotes</code> property not supported in Safari 4.
 </em>/</p>
<p>q:before,
q:after {
    content: '';
    content: none;
}</p>
<p>/*<em>
 * Address inconsistent and variable font size in all browsers.
 </em>/</p>
<p>small {
    font-size: 80%;
}</p>
<p>/*<em>
 * Prevent <code>sub</code> and <code>sup</code> affecting <code>line-height</code> in all browsers.
 </em>/</p>
<p>sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}</p>
<p>sup {
    top: -0.5em;
}</p>
<p>sub {
    bottom: -0.25em;
}</p>
<p>/<em> ==========================================================================
   Lists
   ========================================================================== </em>/</p>
<p>/*<em>
 * Address margins set differently in IE 6/7.
 </em>/</p>
<p>dl,
menu,
ol,
ul {
    margin: 1em 0;
}</p>
<p>dd {
    margin: 0 0 0 40px;
}</p>
<p>/*<em>
 * Address paddings set differently in IE 6/7.
 </em>/</p>
<p>menu,
ol,
ul {
    padding: 0 0 0 40px;
}</p>
<p>/*<em>
 * Correct list images handled incorrectly in IE 7.
 </em>/</p>
<p>nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}</p>
<p>/<em> ==========================================================================
   Embedded content
   ========================================================================== </em>/</p>
<p>/*<em>
 * 1. Remove border when inside <code>a</code> element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 </em>/</p>
<p>img {
    border: 0; /<em> 1 </em>/
    -ms-interpolation-mode: bicubic; /<em> 2 </em>/
}</p>
<p>/*<em>
 * Correct overflow displayed oddly in IE 9.
 </em>/</p>
<p>svg:not(:root) {
    overflow: hidden;
}</p>
<p>/<em> ==========================================================================
   Figures
   ========================================================================== </em>/</p>
<p>/*<em>
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 </em>/</p>
<p>figure {
    margin: 0;
}</p>
<p>/<em> ==========================================================================
   Forms
   ========================================================================== </em>/</p>
<p>/*<em>
 * Correct margin displayed oddly in IE 6/7.
 </em>/</p>
<p>form {
    margin: 0;
}</p>
<p>/*<em>
 * Define consistent border, margin, and padding.
 </em>/</p>
<p>fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}</p>
<p>/*<em>
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 </em>/</p>
<p>legend {
    border: 0; /<em> 1 </em>/
    padding: 0;
    white-space: normal; /<em> 2 </em>/
    <em>margin-left: -7px; /</em> 3 */
}</p>
<p>/*<em>
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 </em>/</p>
<p>button,
input,
select,
textarea {
    font-size: 100%; /<em> 1 </em>/
    margin: 0; /<em> 2 </em>/
    vertical-align: baseline; /<em> 3 </em>/
    <em>vertical-align: middle; /</em> 3 */
}</p>
<p>/*<em>
 * Address Firefox 3+ setting <code>line-height</code> on <code>input</code> using <code>!important</code> in
 * the UA stylesheet.
 </em>/</p>
<p>button,
input {
    line-height: normal;
}</p>
<p>/*<em>
 * Address inconsistent <code>text-transform</code> inheritance for <code>button</code> and <code>select</code>.
 * All other form control elements do not inherit <code>text-transform</code> values.
 * Correct <code>button</code> style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct <code>select</code> style inheritance in Firefox 4+ and Opera.
 </em>/</p>
<p>button,
select {
    text-transform: none;
}</p>
<p>/<em><em>
 * 1. Avoid the WebKit bug in Android 4.0.</em> where (2) destroys native <code>audio</code>
 *    and <code>video</code> controls.
 * 2. Correct inability to style clickable <code>input</code> types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    <code>input</code> and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 </em>/</p>
<p>button,
html input[type="button"], /<em> 1 </em>/
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /<em> 2 </em>/
    cursor: pointer; /<em> 3 </em>/
    <em>overflow: visible;  /</em> 4 */
}</p>
<p>/*<em>
 * Re-set default cursor for disabled elements.
 </em>/</p>
<p>button[disabled],
html input[disabled] {
    cursor: default;
}</p>
<p>/*<em>
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 </em>/</p>
<p>input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /<em> 1 </em>/
    padding: 0; /<em> 2 </em>/
    <em>height: 13px; /</em> 3 <em>/
    </em>width: 13px; /<em> 3 </em>/
}</p>
<p>/*<em>
 * 1. Address <code>appearance</code> set to <code>searchfield</code> in Safari 5 and Chrome.
 * 2. Address <code>box-sizing</code> set to <code>border-box</code> in Safari 5 and Chrome
 *    (include <code>-moz</code> to future-proof).
 </em>/</p>
<p>input[type="search"] {
    -webkit-appearance: textfield; /<em> 1 </em>/
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /<em> 2 </em>/
    box-sizing: content-box;
}</p>
<p>/*<em>
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 </em>/</p>
<p>input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}</p>
<p>/*<em>
 * Remove inner padding and border in Firefox 3+.
 </em>/</p>
<p>button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}</p>
<p>/*<em>
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 </em>/</p>
<p>textarea {
    overflow: auto; /<em> 1 </em>/
    vertical-align: top; /<em> 2 </em>/
}</p>
<p>/<em> ==========================================================================
   Tables
   ========================================================================== </em>/</p>
<p>/*<em>
 * Remove most spacing between table cells.
 </em>/</p>
<p>table {
    border-collapse: collapse;
    border-spacing: 0;
}</p>
</style>

<style type="text/css">

<p>html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }</p>
<p>#top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }</p>
<p>#footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }</p>
<p>h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }</p>
<p>h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }</p>
<p>h3 {
    margin: 25px 0 10px 0;
  }</p>
<p>h4 {
    margin: 0;
    font-size: 105%;
  }</p>
<p>a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }</p>
<p>a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }</p>
<p>pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }</p>
<p>.title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }</p>
<p>code {
    background: #f9f9f9;
  } </p>
<p>pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }</p>
<p>.codehilite {
    margin: 0 30px 10px 30px;
  }</p>
<pre><code>.codehilite pre {
  margin: 0;
}
.codehilite .err { background: #ff3300; color: #fff !important; }
</code></pre>
<p>table#module-list {
    font-size: 110%;
  }</p>
<pre><code>table#module-list tr td:first-child {
  padding-right: 10px;
  white-space: nowrap;
}

table#module-list td {
  vertical-align: top;
  padding-bottom: 8px;
}

  table#module-list td p {
    margin: 0 0 7px 0;
  }
</code></pre>
<p>.def {
    display: table;
  }</p>
<pre><code>.def p {
  display: table-cell;
  vertical-align: top;
  text-align: left;
}

.def p:first-child {
  white-space: nowrap;
}

.def p:last-child {
  width: 100%;
}
</code></pre>
<p>#index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /<em> font-size: 110%; </em>/
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }</p>
<p>.item {
    margin: 0 0 15px 0;
  }</p>
<pre><code>.item .class {
  margin: 0 0 25px 30px;
}

  .item .class ul.class_list {
    margin: 0 0 20px 0;
  }

.item .name {
  background: #fafafa;
  margin: 0;
  font-weight: bold;
  padding: 5px 10px;
  border-radius: 3px;
  display: inline-block;
  min-width: 40%;
}
  .item .name:hover {
    background: #f6f6f6;
  }

.item .empty_desc {
  margin: 0 0 5px 0;
  padding: 0;
}

.item .inheritance {
  margin: 3px 0 0 30px;
}

.item .inherited {
  color: #666;
}

.item .desc {
  padding: 0 8px;
  margin: 0;
}

  .item .desc p {
    margin: 0 0 10px 0;
  }

.source_cont {
  margin: 0;
  padding: 0;
}

.source_link a {
  background: #ffc300;
  font-weight: 400;
  font-size: .75em;
  text-transform: uppercase;
  color: #fff;
  text-shadow: 1px 1px 0 #f4b700;

  padding: 3px 8px;
  border-radius: 2px;
  transition: background .3s ease-in-out;
}
  .source_link a:hover {
    background: #FF7200;
    text-shadow: none;
    transition: background .3s ease-in-out;
  }

.source {
  display: none;
  max-height: 600px;
  overflow-y: scroll;
  margin-bottom: 15px;
}

  .source .codehilite {
    margin: 0;
  }
</code></pre>
<p>.desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }</p>
<p>@media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }</p>
<pre><code>#index ul {
  padding: 0;
  margin-bottom: 15px;
}
#index ul li {
  display: inline-block;
  margin-right: 30px;
}
#footer {
  text-align: left;
}
#footer p {
  display: block;
  margin: inherit;
}
</code></pre>
<p>}</p>
<p>/<strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong><strong><em>*</em></strong>*/</p>
</style>

<p><style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /<em> Comment </em>/
.codehilite .err { border: 1px solid #FF0000 } /<em> Error </em>/
.codehilite .k { color: #008000; font-weight: bold } /<em> Keyword </em>/
.codehilite .o { color: #666666 } /<em> Operator </em>/
.codehilite .ch { color: #408080; font-style: italic } /<em> Comment.Hashbang </em>/
.codehilite .cm { color: #408080; font-style: italic } /<em> Comment.Multiline </em>/
.codehilite .cp { color: #BC7A00 } /<em> Comment.Preproc </em>/
.codehilite .cpf { color: #408080; font-style: italic } /<em> Comment.PreprocFile </em>/
.codehilite .c1 { color: #408080; font-style: italic } /<em> Comment.Single </em>/
.codehilite .cs { color: #408080; font-style: italic } /<em> Comment.Special </em>/
.codehilite .gd { color: #A00000 } /<em> Generic.Deleted </em>/
.codehilite .ge { font-style: italic } /<em> Generic.Emph </em>/
.codehilite .gr { color: #FF0000 } /<em> Generic.Error </em>/
.codehilite .gh { color: #000080; font-weight: bold } /<em> Generic.Heading </em>/
.codehilite .gi { color: #00A000 } /<em> Generic.Inserted </em>/
.codehilite .go { color: #888888 } /<em> Generic.Output </em>/
.codehilite .gp { color: #000080; font-weight: bold } /<em> Generic.Prompt </em>/
.codehilite .gs { font-weight: bold } /<em> Generic.Strong </em>/
.codehilite .gu { color: #800080; font-weight: bold } /<em> Generic.Subheading </em>/
.codehilite .gt { color: #0044DD } /<em> Generic.Traceback </em>/
.codehilite .kc { color: #008000; font-weight: bold } /<em> Keyword.Constant </em>/
.codehilite .kd { color: #008000; font-weight: bold } /<em> Keyword.Declaration </em>/
.codehilite .kn { color: #008000; font-weight: bold } /<em> Keyword.Namespace </em>/
.codehilite .kp { color: #008000 } /<em> Keyword.Pseudo </em>/
.codehilite .kr { color: #008000; font-weight: bold } /<em> Keyword.Reserved </em>/
.codehilite .kt { color: #B00040 } /<em> Keyword.Type </em>/
.codehilite .m { color: #666666 } /<em> Literal.Number </em>/
.codehilite .s { color: #BA2121 } /<em> Literal.String </em>/
.codehilite .na { color: #7D9029 } /<em> Name.Attribute </em>/
.codehilite .nb { color: #008000 } /<em> Name.Builtin </em>/
.codehilite .nc { color: #0000FF; font-weight: bold } /<em> Name.Class </em>/
.codehilite .no { color: #880000 } /<em> Name.Constant </em>/
.codehilite .nd { color: #AA22FF } /<em> Name.Decorator </em>/
.codehilite .ni { color: #999999; font-weight: bold } /<em> Name.Entity </em>/
.codehilite .ne { color: #D2413A; font-weight: bold } /<em> Name.Exception </em>/
.codehilite .nf { color: #0000FF } /<em> Name.Function </em>/
.codehilite .nl { color: #A0A000 } /<em> Name.Label </em>/
.codehilite .nn { color: #0000FF; font-weight: bold } /<em> Name.Namespace </em>/
.codehilite .nt { color: #008000; font-weight: bold } /<em> Name.Tag </em>/
.codehilite .nv { color: #19177C } /<em> Name.Variable </em>/
.codehilite .ow { color: #AA22FF; font-weight: bold } /<em> Operator.Word </em>/
.codehilite .w { color: #bbbbbb } /<em> Text.Whitespace </em>/
.codehilite .mb { color: #666666 } /<em> Literal.Number.Bin </em>/
.codehilite .mf { color: #666666 } /<em> Literal.Number.Float </em>/
.codehilite .mh { color: #666666 } /<em> Literal.Number.Hex </em>/
.codehilite .mi { color: #666666 } /<em> Literal.Number.Integer </em>/
.codehilite .mo { color: #666666 } /<em> Literal.Number.Oct </em>/
.codehilite .sa { color: #BA2121 } /<em> Literal.String.Affix </em>/
.codehilite .sb { color: #BA2121 } /<em> Literal.String.Backtick </em>/
.codehilite .sc { color: #BA2121 } /<em> Literal.String.Char </em>/
.codehilite .dl { color: #BA2121 } /<em> Literal.String.Delimiter </em>/
.codehilite .sd { color: #BA2121; font-style: italic } /<em> Literal.String.Doc </em>/
.codehilite .s2 { color: #BA2121 } /<em> Literal.String.Double </em>/
.codehilite .se { color: #BB6622; font-weight: bold } /<em> Literal.String.Escape </em>/
.codehilite .sh { color: #BA2121 } /<em> Literal.String.Heredoc </em>/
.codehilite .si { color: #BB6688; font-weight: bold } /<em> Literal.String.Interpol </em>/
.codehilite .sx { color: #008000 } /<em> Literal.String.Other </em>/
.codehilite .sr { color: #BB6688 } /<em> Literal.String.Regex </em>/
.codehilite .s1 { color: #BA2121 } /<em> Literal.String.Single </em>/
.codehilite .ss { color: #19177C } /<em> Literal.String.Symbol </em>/
.codehilite .bp { color: #008000 } /<em> Name.Builtin.Pseudo </em>/
.codehilite .fm { color: #0000FF } /<em> Name.Function.Magic </em>/
.codehilite .vc { color: #19177C } /<em> Name.Variable.Class </em>/
.codehilite .vg { color: #19177C } /<em> Name.Variable.Global </em>/
.codehilite .vi { color: #19177C } /<em> Name.Variable.Instance </em>/
.codehilite .vm { color: #19177C } /<em> Name.Variable.Magic </em>/
.codehilite .il { color: #666666 } /<em> Literal.Number.Integer.Long </em>/
  </style></p>
<style type="text/css">

<p>/<em> ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== </em>/</p>
<p>@media only screen and (min-width: 35em) {
    /<em> Style adjustments for viewports that meet the condition </em>/
}</p>
<p>@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /<em> Style adjustments for high resolution devices </em>/
}</p>
<p>/<em> ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== </em>/</p>
<p>@media print {
    * {
        background: transparent !important;
        color: #000 !important; /<em> Black prints faster: h5bp.com/s </em>/
        box-shadow: none !important;
        text-shadow: none !important;
    }</p>
<pre><code>a,
a:visited {
    text-decoration: underline;
}

a[href]:after {
    content: " (" attr(href) ")";
}

abbr[title]:after {
    content: " (" attr(title) ")";
}

/*
 * Don't show links for images, or javascript/internal links
 */

.ir a:after,
a[href^="javascript:"]:after,
a[href^="#"]:after {
    content: "";
}

pre,
blockquote {
    border: 1px solid #999;
    page-break-inside: avoid;
}

thead {
    display: table-header-group; /* h5bp.com/t */
}

tr,
img {
    page-break-inside: avoid;
}

img {
    max-width: 100% !important;
}

@page {
    margin: 0.5cm;
}

p,
h2,
h3 {
    orphans: 3;
    widows: 3;
}

h2,
h3 {
    page-break-after: avoid;
}
</code></pre>
<p>}</p>
</style>

<p><script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a></p>
<div id="container">

  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#taskcat.TaskCat">TaskCat</a></span>


  <ul>
    <li class="mono"><a href="#taskcat.TaskCat.__init__">__init__</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.aws_api_init">aws_api_init</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.cleanup">cleanup</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.collect_resources">collect_resources</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.createcfnlogs">createcfnlogs</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.createreport">createreport</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.deep_cleanup">deep_cleanup</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.define_tests">define_tests</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.genpassword">genpassword</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.genreport">genreport</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_all_resources">get_all_resources</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_available_azs">get_available_azs</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_capabilities">get_capabilities</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_cfnlogs">get_cfnlogs</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_config">get_config</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_default_region">get_default_region</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_docleanup">get_docleanup</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_global_region">get_global_region</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_parameter_file">get_parameter_file</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_parameter_path">get_parameter_path</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_password">get_password</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_project">get_project</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_resources">get_resources</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_resources_helper">get_resources_helper</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_s3_url">get_s3_url</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_s3bucket">get_s3bucket</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_s3contents">get_s3contents</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_stackstatus">get_stackstatus</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_template_file">get_template_file</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_template_path">get_template_path</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.get_test_region">get_test_region</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.if_stackexists">if_stackexists</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.parse_stack_info">parse_stack_info</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.regxfind">regxfind</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_capabilities">set_capabilities</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_config">set_config</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_default_region">set_default_region</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_docleanup">set_docleanup</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_parameter_file">set_parameter_file</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_parameter_path">set_parameter_path</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_password">set_password</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_project">set_project</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_s3bucket">set_s3bucket</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_template_file">set_template_file</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_template_path">set_template_path</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.set_test_region">set_test_region</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.stackcheck">stackcheck</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.stackcreate">stackcreate</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.stackdelete">stackdelete</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.stage_in_s3">stage_in_s3</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.validate_json">validate_json</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.validate_parameters">validate_parameters</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.validate_template">validate_template</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.validate_yaml">validate_yaml</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.welcome">welcome</a></li>
    <li class="mono"><a href="#taskcat.TaskCat.write_logs">write_logs</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">






  <header id="section-intro">
  <h1 class="title"><span class="name">taskcat</span> module</h1>


  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat', this);">Show source &equiv;</a></p>
  <div id="source-taskcat" class="source">
    <div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>
<span class="c1"># authors:</span>
<span class="c1"># Tony Vattathil tonynv@amazon.com, avattathil@gmail.com</span>
<span class="c1"># Shivansh Singh sshvans@amazon.com,</span>
<span class="c1"># Santiago Cardenas sancard@amazon.com,</span>
<span class="c1">#</span>
<span class="c1"># repo: https://github.com/aws-quickstart/taskcat</span>
<span class="c1"># docs: https://aws-quickstart.github.io/taskcat/</span>
<span class="c1">#</span>
<span class="c1"># This program takes as input:</span>
<span class="c1"># CloudFormation template and json formatted parameter input file</span>
<span class="c1"># To create tests define the test params in config.yml (Example below)</span>
<span class="c1"># Planned Features:</span>
<span class="c1"># - Email test results to owner of project</span>

<span class="c1"># --imports --</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">RawTextHelpFormatter</span>

<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">pyfiglet</span>
<span class="kn">import</span> <span class="nn">tabulate</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">yattag</span>
<span class="kn">from</span> <span class="nn">botocore.client</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">botocore.vendored</span> <span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="nn">botocore.exceptions</span> <span class="kn">import</span> <span class="n">ClientError</span>
<span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">get_distribution</span>

<span class="kn">from</span> <span class="nn">taskcat.sweeper</span> <span class="kn">import</span> <span class="n">Sweeper</span>

<span class="c1"># Version Tag</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="n">get_distribution</span><span class="p">(</span><span class="s1">&#39;taskcat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>
<span class="n">version</span><span class="o">=</span><span class="n">__version__</span>
<span class="n">debug</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">check</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">fail</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="s2">&quot;dENhVA==&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="n">jobid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;41;0m&#39;</span>
<span class="n">hightlight</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0;30;47m&#39;</span>
<span class="n">name_color</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0;37;44m&#39;</span>
<span class="n">aqua</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0;30;46m&#39;</span>
<span class="n">green</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0;30;42m&#39;</span>
<span class="n">white</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0;30;47m&#39;</span>
<span class="n">orange</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0;30;43m&#39;</span>
<span class="n">red</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0;30;41m&#39;</span>
<span class="n">rst_color</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span>
<span class="n">E</span> <span class="o">=</span> <span class="s1">&#39;{1}[ERROR {0} ]{2} :&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">)</span>
<span class="n">D</span> <span class="o">=</span> <span class="s1">&#39;{1}[DEBUG {0} ]{2} :&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="n">aqua</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="s1">&#39;{1}[PASS  {0} ]{2} :&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="s1">&#39;{1}[FAIL  {0} ]{2} :&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fail</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">)</span>
<span class="n">I</span> <span class="o">=</span> <span class="s1">&#39;{1}[INFO  {0} ]{2} :&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">orange</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">)</span>

<span class="c1"># Example config.yml</span>
<span class="c1"># --Begin</span>
<span class="n">yaml_cfg</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">global:</span>
<span class="s1">  notification: true</span>
<span class="s1">  owner: avattathil@gmail.com</span>
<span class="s1">  project: projectx</span>
<span class="s1">  reporting: true</span>
<span class="s1">  regions:</span>
<span class="s1">    - us-east-1</span>
<span class="s1">    - us-west-1</span>
<span class="s1">    - us-west-2</span>
<span class="s1">  report_email-to-owner: true</span>
<span class="s1">  report_publish-to-s3: true</span>
<span class="s1">  report_s3bucket: taskcat-reports</span>
<span class="s1">  s3bucket: projectx-templates</span>
<span class="s1">tests:</span>
<span class="s1">  projectx-scenario-1:</span>
<span class="s1">    parameter_input: projectx-scenario-1.json</span>
<span class="s1">    regions:</span>
<span class="s1">      - us-west-1</span>
<span class="s1">      - us-east-1</span>
<span class="s1">    template_file: projectx.template</span>
<span class="s1">  projetx-mainscenarioo-all-regions:</span>
<span class="s1">    parameter_input: projectx-scenario-all-regions.json</span>
<span class="s1">    template_file: projectx.template</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="c1"># --End</span>
<span class="c1"># Example config.yml</span>

<span class="c1"># Not implemented</span>
<span class="c1"># ------------------------------- System variables</span>
<span class="c1"># --Begin</span>
<span class="n">sys_yml</span> <span class="o">=</span> <span class="s1">&#39;sys_config.yml&#39;</span>


<span class="c1"># --End</span>
<span class="c1"># --------------------------------System variables</span>


<span class="k">def</span> <span class="nf">buildmap</span><span class="p">(</span><span class="n">start_location</span><span class="p">,</span> <span class="n">mapstring</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a start location and a string value, this function returns a list of</span>
<span class="sd">    file paths containing the given string value, down in the directory</span>
<span class="sd">    structure from the start location.</span>

<span class="sd">    :param start_location: directory from where to start looking for the file</span>
<span class="sd">    :param mapstring: value to match in the file path</span>
<span class="sd">    :return:</span>
<span class="sd">        list of file paths containing the given value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fs_map</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fs_path</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">filelist</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">start_location</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fs_file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="n">fs_path_to_file</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fs_path</span><span class="p">,</span> <span class="n">fs_file</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mapstring</span> <span class="ow">in</span> <span class="n">fs_path_to_file</span> <span class="ow">and</span> <span class="s1">&#39;.git&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fs_path_to_file</span><span class="p">:</span>
                <span class="n">fs_map</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fs_path_to_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fs_map</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to represent the test data.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">TestData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__test_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__test_stacks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">set_test_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__test_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_test_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__test_name</span>

    <span class="k">def</span> <span class="nf">get_test_stacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__test_stacks</span>

    <span class="k">def</span> <span class="nf">add_test_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__test_stacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Task(Cat = CloudFormation Automated Testing)</span>

<span class="sd">    This is the main TaskCat class, which provides various functions to</span>
<span class="sd">    perform testing of CloudFormation templates in multiple regions and</span>
<span class="sd">    generate report.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># noinspection PyUnresolvedReferences</span>
<span class="k">class</span> <span class="nc">TaskCat</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># CONSTRUCTOR</span>
    <span class="c1"># ============</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nametag</span><span class="o">=</span><span class="s1">&#39;[taskcat]&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">=</span> <span class="s1">&#39;{1}{0}{2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nametag</span><span class="p">,</span> <span class="n">name_color</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="s1">&#39;config.yml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defult_region</span> <span class="o">=</span> <span class="s2">&quot;us-east-1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_template_file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_termsize</span> <span class="o">=</span> <span class="mi">110</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_banner</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_global</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1"># SETTERS AND GETTERS</span>
    <span class="c1"># ===================</span>

    <span class="k">def</span> <span class="nf">set_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>

    <span class="k">def</span> <span class="nf">get_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

    <span class="k">def</span> <span class="nf">set_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ability</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ability</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span>

    <span class="k">def</span> <span class="nf">set_s3bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="o">=</span> <span class="n">bucket</span>

    <span class="k">def</span> <span class="nf">get_s3bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_yml</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">config_yml</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config_yml</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Cannot locate file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">config_yml</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>

    <span class="k">def</span> <span class="nf">get_template_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_file</span>

    <span class="k">def</span> <span class="nf">set_template_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_template_file</span> <span class="o">=</span> <span class="n">template</span>

    <span class="k">def</span> <span class="nf">set_parameter_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_file</span> <span class="o">=</span> <span class="n">parameter</span>

    <span class="k">def</span> <span class="nf">get_parameter_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_file</span>

    <span class="k">def</span> <span class="nf">set_parameter_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span> <span class="o">=</span> <span class="n">parameter</span>

    <span class="k">def</span> <span class="nf">get_parameter_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span>

    <span class="k">def</span> <span class="nf">set_template_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span> <span class="o">=</span> <span class="n">template</span>

    <span class="k">def</span> <span class="nf">get_template_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span>

    <span class="k">def</span> <span class="nf">set_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="n">password</span>

    <span class="k">def</span> <span class="nf">get_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_password</span>

    <span class="k">def</span> <span class="nf">set_default_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defult_region</span> <span class="o">=</span> <span class="n">region</span>

    <span class="k">def</span> <span class="nf">get_default_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defult_region</span>

    <span class="k">def</span> <span class="nf">get_test_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span>

    <span class="k">def</span> <span class="nf">set_test_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">region_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_docleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cleanup_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span> <span class="o">=</span> <span class="n">cleanup_value</span>

    <span class="k">def</span> <span class="nf">get_docleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span>

    <span class="c1">#      FUNCTIONS       #</span>
    <span class="c1"># ==================== #</span>

    <span class="k">def</span> <span class="nf">stage_in_s3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload templates and other artifacts to s3.</span>

<span class="sd">        This function creates the s3 bucket with name provided in the config yml file. If</span>
<span class="sd">        no bucket name provided, it creates the s3 bucket using project name provided in</span>
<span class="sd">        config yml file. And uploads the templates and other artifacts to the s3 bucket.</span>

<span class="sd">        :param taskcat_cfg: Taskcat configuration provided in yml file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |CONTENTS OF  S3 BUCKET{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>

        <span class="n">project</span> <span class="o">=</span> <span class="n">taskcat_cfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;qsname&#39;</span><span class="p">]</span>

        <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;s3bucket&#39;</span> <span class="ow">in</span> <span class="n">taskcat_cfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;s3bucket&#39;</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Staging Bucket =&gt; &quot;</span> <span class="o">+</span> <span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_s3bucket</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">auto_bucket</span> <span class="o">=</span> <span class="s1">&#39;taskcat-&#39;</span> <span class="o">+</span> <span class="n">project</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">jobid</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Staging Bucket =&gt; &quot;</span> <span class="o">+</span> <span class="n">auto_bucket</span><span class="p">)</span>
            <span class="n">s3</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">auto_bucket</span><span class="p">)</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">auto_bucket</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_s3bucket</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_project</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">project</span><span class="p">):</span>
            <span class="n">fsmap</span> <span class="o">=</span> <span class="n">buildmap</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">project</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">example1</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            # Name of example project = [projectx]</span>
<span class="s1">            # Command issued to run taskcat = taskcat.py -c projectx/ci/config.yml</span>
<span class="s1">            Hint: if taskcat.py is not in your path specify the full path to taskcat.py</span>
<span class="s1">            </span>
<span class="s1">            # Example of expected directory/project structure</span>
<span class="s1">            projectx</span>
<span class="s1">             LICENSE.txt</span>
<span class="s1">             ci</span>
<span class="s1">              taskcat.yml         # TaskCat Configuration file</span>
<span class="s1">              projectx-input.json # Inputs to pass during stackcreation</span>
<span class="s1">             scripts</span>
<span class="s1">              project-userdata.sh # Any scripts that is part of this project</span>
<span class="s1">             templates</span>
<span class="s1">                 projectx.template</span>

<span class="s1">            # Contents of taskcat.yml</span>
<span class="s1">            global:</span>
<span class="s1">              qsname: projectx</span>
<span class="s1">              regions:</span>
<span class="s1">                - us-east-1</span>
<span class="s1">                - us-west-1</span>
<span class="s1">                - us-west-2</span>
<span class="s1">             </span>
<span class="s1">            tests:</span>
<span class="s1">              projectx-test:</span>
<span class="s1">                template_file: projectx.template</span>
<span class="s1">                parameter_input: projectx-input.json</span>
<span class="s1">                &#39;&#39;&#39;</span>

            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\t\t</span><span class="s1"> Hint: The name specfied as value of qsname ({})</span>
<span class="s1">                    must match the root directory of your project&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}!Cannot find directory [{1}] in {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">    Example:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">example1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Please cd to where you project is located&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">fsmap</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">upload</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;^./&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="n">bucket</span><span class="o">.</span><span class="n">Acl</span><span class="p">()</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">ACL</span><span class="o">=</span><span class="s1">&#39;public-read&#39;</span><span class="p">)</span>
                <span class="n">bucket</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                                   <span class="n">upload</span><span class="p">,</span>
                                   <span class="n">ExtraArgs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ACL&#39;</span><span class="p">:</span> <span class="s1">&#39;public-read&#39;</span><span class="p">})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Cannot Upload to bucket =&gt; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Check that you bucketname is correct&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">o</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;{0}/{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_available_azs</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of availability zones in a given region.</span>

<span class="sd">        :param region: Region for the availability zones</span>
<span class="sd">        :param count: Minimum number of availability zones needed</span>

<span class="sd">        :return: List of availability zones in a given region</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">available_azs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
        <span class="n">availability_zones</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_availability_zones</span><span class="p">(</span>
            <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;Values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]}])</span>

        <span class="k">for</span> <span class="n">az</span> <span class="ow">in</span> <span class="n">availability_zones</span><span class="p">[</span><span class="s1">&#39;AvailabilityZones&#39;</span><span class="p">]:</span>
            <span class="n">available_azs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">az</span><span class="p">[</span><span class="s1">&#39;ZoneName&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_azs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}!Only {1} az&#39;s are available in {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_azs</span><span class="p">),</span> <span class="n">region</span><span class="p">))</span>
            <span class="n">quit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">azs</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available_azs</span><span class="p">[:</span><span class="n">count</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">azs</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_s3contents</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">payload</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span> <span class="nf">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns S3 url of a given object.</span>

<span class="sd">        :param key: Name of the object whose S3 url is being returned</span>
<span class="sd">        :return: S3 url of the given key</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="s1">&#39;s3v4&#39;</span><span class="p">))</span>

        <span class="n">bucket_location</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_bucket_location</span><span class="p">(</span>
            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span>
                                     <span class="n">Prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">())</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Contents&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s3obj</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">s3obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Key&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="c1"># Finding exact match</span>
                        <span class="n">terms</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">terms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">bucket_location</span><span class="p">[</span>
                                <span class="s1">&#39;LocationConstraint&#39;</span>
                            <span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="n">o_url</span> <span class="o">=</span> <span class="s2">&quot;https://s3-{0}.{1}/{2}/{3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">bucket_location</span><span class="p">[</span><span class="s1">&#39;LocationConstraint&#39;</span><span class="p">],</span>
                                    <span class="s2">&quot;amazonaws.com&quot;</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span>
                                    <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">return</span> <span class="n">o_url</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">amzns3</span> <span class="o">=</span> <span class="s1">&#39;s3.amazonaws.com&#39;</span>
                                <span class="n">o_url</span> <span class="o">=</span> <span class="s2">&quot;https://{0}/{1}/{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amzns3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">return</span> <span class="n">o_url</span>

    <span class="k">def</span> <span class="nf">get_global_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yamlcfg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of regions defined under global region in the yml config file.</span>

<span class="sd">        :param yamlcfg: Content of the yml config file</span>
<span class="sd">        :return: List of regions</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g_regions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">yamlcfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;region&#39;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">iter</span><span class="p">(</span><span class="n">yamlcfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">])</span>
                    <span class="n">namespace</span> <span class="o">=</span> <span class="s1">&#39;global&#39;</span>
                    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">yamlcfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">]:</span>
                        <span class="c1"># print(&quot;found region %s&quot; % region)</span>
                        <span class="n">g_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_use_global</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No regions defined in [</span><span class="si">%s</span><span class="s2">]:&quot;</span> <span class="o">%</span> <span class="n">namespace</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Please correct region defs[</span><span class="si">%s</span><span class="s2">]:&quot;</span> <span class="o">%</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g_regions</span>

    <span class="k">def</span> <span class="nf">get_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">include_stacks</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a stackname, and region function returns the list of dictionary items, where each item</span>
<span class="sd">        consist of logicalId, physicalId and resourceType of the aws resource associated</span>
<span class="sd">        with the stack.</span>

<span class="sd">        :param include_stacks: </span>
<span class="sd">        :param stackname: CloudFormation stack name</span>
<span class="sd">        :param region: AWS region</span>
<span class="sd">        :return: List of objects in the following format</span>
<span class="sd">             [</span>
<span class="sd">                 {</span>
<span class="sd">                     &#39;logicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                     &#39;physicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                     &#39;resourceType&#39;: &#39;String&#39;</span>
<span class="sd">                 },</span>
<span class="sd">             ]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l_resources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_resources_helper</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">l_resources</span><span class="p">,</span> <span class="n">include_stacks</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l_resources</span>

    <span class="k">def</span> <span class="nf">get_resources_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">l_resources</span><span class="p">,</span> <span class="n">include_stacks</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a helper function of get_resources function. Check get_resources function for details.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stackname</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                    <span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">describe_stack_resources</span><span class="p">(</span>
                    <span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
                <span class="n">stackresources</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackResources&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">stackresources</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Resources: for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stackname</span><span class="p">))</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;{0} = {1}, {2} = {3}, {4} = {5}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">LogicalId&#39;</span><span class="p">,</span>
                            <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">PhysicalId&#39;</span><span class="p">,</span>
                            <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">Type&#39;</span><span class="p">,</span>
                            <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">)</span>
                        <span class="p">))</span>
                    <span class="c1"># if resource is a stack and has a physical resource id (NOTE: physical id will be missing if stack creation is failed)</span>
                    <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="s1">&#39;ResourceType&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;AWS::CloudFormation::Stack&#39;</span> <span class="ow">and</span> <span class="s1">&#39;PhysicalResourceId&#39;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">include_stacks</span><span class="p">:</span>
                            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">),</span>
                                 <span class="s1">&#39;physicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span>
                                 <span class="s1">&#39;resourceType&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">)}</span>
                            <span class="n">l_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                        <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">)))</span>
                        <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_resources_helper</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span> <span class="n">region</span><span class="p">,</span> <span class="n">l_resources</span><span class="p">,</span>
                                                  <span class="n">include_stacks</span><span class="p">)</span>
                    <span class="c1"># else if resource is not a stack and has a physical resource id (NOTE: physical id will be missing if stack creation is failed)</span>
                    <span class="k">elif</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="s1">&#39;ResourceType&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;AWS::CloudFormation::Stack&#39;</span> <span class="ow">and</span> <span class="s1">&#39;PhysicalResourceId&#39;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;physicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;resourceType&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">)}</span>
                        <span class="n">l_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Unable to get resources for stack </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stackname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_all_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackids</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of stackids, function returns the list of dictionary items, where each</span>
<span class="sd">        item consist of stackId and the resources associated with that stack.</span>

<span class="sd">        :param stackids: List of Stack Ids</span>
<span class="sd">        :param region: AWS region</span>
<span class="sd">        :return: A list of dictionary object in the following format</span>
<span class="sd">                [</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;stackId&#39;: &#39;string&#39;,</span>
<span class="sd">                        &#39;resources&#39;: [</span>
<span class="sd">                            {</span>
<span class="sd">                               &#39;logicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                               &#39;physicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                               &#39;resourceType&#39;: &#39;String&#39;</span>
<span class="sd">                            },</span>
<span class="sd">                        ]</span>
<span class="sd">                    },</span>
<span class="sd">                ]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l_all_resources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">anId</span> <span class="ow">in</span> <span class="n">stackids</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;stackId&#39;</span><span class="p">:</span> <span class="n">anId</span><span class="p">,</span>
                <span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span><span class="n">anId</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">l_all_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l_all_resources</span>

    <span class="k">def</span> <span class="nf">validate_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns TRUE if all the template files are valid, otherwise FALSE.</span>

<span class="sd">        :param taskcat_cfg: TaskCat config object</span>
<span class="sd">        :param test_list: List of tests</span>

<span class="sd">        :return: TRUE if templates are valid, else FALSE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load global regions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_test_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_region</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Validate Template in test[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">define_tests</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Default region [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_region</span><span class="p">())</span>
                <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_region</span><span class="p">())</span>
                <span class="n">cfn</span><span class="o">.</span><span class="n">validate_template</span><span class="p">(</span><span class="n">TemplateURL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">validate_template</span><span class="p">(</span><span class="n">TemplateURL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
                <span class="k">print</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="s2">&quot;Validated [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">())</span>
                <span class="n">cfn_result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">])</span>
                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Description  [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">cfn_result</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">cfn_params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Parameters:&quot;</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">cfn_params</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Cannot validate </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">genpassword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pass_length</span><span class="p">,</span> <span class="n">pass_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a password of given length and type.</span>

<span class="sd">        :param pass_length: Length of the desired password</span>
<span class="sd">        :param pass_type: Type of the desired password - String only OR Alphanumeric</span>
<span class="sd">            * A = AlphaNumeric, Example &#39;vGceIP8EHC&#39;</span>
<span class="sd">        :return: Password of given length and type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Auto generating password&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass size =&gt; {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pass_length</span><span class="p">))</span>

        <span class="n">password</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="s2">&quot;1234567890&quot;</span>
        <span class="n">lowercase</span> <span class="o">=</span> <span class="s2">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
        <span class="n">uppercase</span> <span class="o">=</span> <span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
        <span class="n">specialchars</span> <span class="o">=</span> <span class="s2">&quot;!#$&amp;{*:[=,]-_%@+&quot;</span>

        <span class="c1"># Generates password string with:</span>
        <span class="c1"># lowercase,uppercase and numeric chars</span>
        <span class="k">if</span> <span class="n">pass_type</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass type =&gt; {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;alpha-numeric&#39;</span><span class="p">))</span>

            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pass_length</span><span class="p">:</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lowercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">uppercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>

        <span class="c1"># Generates password string with:</span>
        <span class="c1"># lowercase,uppercase, numbers and special chars</span>
        <span class="k">elif</span> <span class="n">pass_type</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass type =&gt; (&#39;specialchars&#39;)&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pass_length</span><span class="p">:</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lowercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">uppercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">specialchars</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If no passtype is defined (None)</span>
            <span class="c1"># Defaults to alpha-numeric</span>
            <span class="c1"># Generates password string with:</span>
            <span class="c1"># lowercase,uppercase, numbers and special chars</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass type =&gt; default (&#39;alpha-numeric&#39;)&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pass_length</span><span class="p">:</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lowercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">uppercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stackcreate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test_list</span><span class="p">,</span> <span class="n">sprefix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function creates CloudFormation stack for the given tests.</span>

<span class="sd">        :param taskcat_cfg: TaskCat config as yaml object</span>
<span class="sd">        :param test_list: List of tests</span>
<span class="sd">        :param sprefix: Special prefix as string. Purpose of this param is to use it for tagging</span>
<span class="sd">            the stack.</span>

<span class="sd">        :return: List of TestData objects</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">testdata_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_capabilities</span><span class="p">(</span><span class="s1">&#39;CAPABILITY_IAM&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">:</span>
            <span class="n">testdata</span> <span class="o">=</span> <span class="n">TestData</span><span class="p">()</span>
            <span class="n">testdata</span><span class="o">.</span><span class="n">set_test_name</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}{1}|PREPARING TO LAUNCH =&gt; {2}{3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
            <span class="n">sname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
            <span class="n">stackname</span> <span class="o">=</span> <span class="n">sname</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">sprefix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">test</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">jobid</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">define_tests</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_region</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Preparing to launch in region [</span><span class="si">%s</span><span class="s2">] &quot;</span> <span class="o">%</span> <span class="n">region</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
                    <span class="n">s_parmsdata</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">s_parms</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s_parmsdata</span><span class="p">)</span>
                    <span class="c1"># gentype = None</span>

                    <span class="c1"># Auto-generated stack inputs</span>

                    <span class="c1"># (Passwords)</span>
                    <span class="c1"># Value that matches the following pattern will be replaced</span>
                    <span class="c1"># - Parameters must start with $[</span>
                    <span class="c1"># - Parameters must end with ]</span>
                    <span class="c1"># - genpass in invoked when _genpass_X is found</span>
                    <span class="c1"># - X is lengeth of the string</span>
                    <span class="c1"># Example: $[taskcat_genpass_8]</span>
                    <span class="c1"># Optionally - you can specify the type of password by adding</span>
                    <span class="c1"># - A aplha-numeric passwords</span>
                    <span class="c1"># - S passwords with special characters</span>
                    <span class="c1"># Example: $[taskcat_genpass_8A]</span>
                    <span class="c1"># Generates: tI8zN3iX8</span>
                    <span class="c1"># or</span>
                    <span class="c1"># Example: $[taskcat_genpass_8S]</span>
                    <span class="c1"># Generates: mA5@cB5!</span>

                    <span class="c1"># (Availablity Zones)</span>
                    <span class="c1"># Value that matches the following pattern will be replaced</span>
                    <span class="c1"># - Parameters must start with $[</span>
                    <span class="c1"># - Parameters must end with ]</span>
                    <span class="c1"># - genaz in invoked when _genaz_X is found</span>
                    <span class="c1"># - A number of AZ&#39;s will be selected from the region</span>
                    <span class="c1">#   the stack is attempting to launch</span>
                    <span class="c1"># Example: $[taskcat_genaz_2] (if the region is us-east-2)</span>
                    <span class="c1"># Generates: us-east-1a, us-east-2b</span>

                    <span class="k">for</span> <span class="n">parmdict</span> <span class="ow">in</span> <span class="n">s_parms</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">parmdict</span><span class="p">:</span>

                            <span class="n">param_value</span> <span class="o">=</span> <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span>
                            <span class="c1"># Determines the size of the password to generate</span>
                            <span class="n">count_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?!\w+_genpass_)\d{1,2}&#39;</span><span class="p">)</span>

                            <span class="c1"># Determines the type of password to generate</span>
                            <span class="n">gentype_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                                <span class="s1">&#39;(?!\w+_genpass_\d{1,2}])([AS])&#39;</span><span class="p">)</span>

                            <span class="c1"># Determines if _genpass has been requested</span>
                            <span class="n">genpass_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                                <span class="s1">&#39;\$\[\w+_genpass?(\w)_\d{1,2}\w?]$&#39;</span><span class="p">)</span>

                            <span class="c1"># Determines if _genaz has been requested</span>
                            <span class="n">genaz_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\$\[\w+_genaz_\d]&#39;</span><span class="p">)</span>

                            <span class="c1"># Determines if s3 replacement was requested</span>
                            <span class="n">gets3replace</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\$\[\w+_url_.+]$&#39;</span><span class="p">)</span>
                            <span class="n">geturl_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=._url_)(.+)(?=]$)&#39;</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">gets3replace</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param_value</span><span class="p">):</span>
                                <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">geturl_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">)</span>
                                <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3contents</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Raw content of url {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
                                <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>

                            <span class="c1"># Autogenerated value to password input in runtime</span>
                            <span class="k">if</span> <span class="n">genpass_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param_value</span><span class="p">):</span>
                                <span class="n">passlen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">count_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">))</span>
                                <span class="n">gentype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span>
                                    <span class="n">gentype_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">)</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">gentype</span><span class="p">:</span>
                                    <span class="c1"># Set default password type</span>
                                    <span class="c1"># A vaule of D will generate a simple alpha</span>
                                    <span class="c1"># aumeric password</span>
                                    <span class="n">gentype</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>

                                <span class="k">if</span> <span class="n">passlen</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}AutoGen values for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">param_value</span><span class="p">))</span>
                                    <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genpassword</span><span class="p">(</span>
                                        <span class="n">passlen</span><span class="p">,</span> <span class="n">gentype</span><span class="p">)</span>
                                    <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>

                            <span class="k">if</span> <span class="n">genaz_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param_value</span><span class="p">):</span>
                                <span class="n">numazs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">count_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">))</span>
                                <span class="k">if</span> <span class="n">numazs</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Selecting availability zones&quot;</span><span class="p">)</span>
                                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Requested </span><span class="si">%s</span><span class="s2"> az&#39;s&quot;</span> <span class="o">%</span> <span class="n">numazs</span><span class="p">)</span>

                                    <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available_azs</span><span class="p">(</span>
                                        <span class="n">region</span><span class="p">,</span>
                                        <span class="n">numazs</span><span class="p">)</span>
                                    <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;$[taskcat_genaz_(!)]&quot;</span><span class="p">)</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Number of az&#39;s not specified!&quot;</span><span class="p">)</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot; - (Defaulting to 1 az)&quot;</span><span class="p">)</span>
                                    <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available_azs</span><span class="p">(</span>
                                        <span class="n">region</span><span class="p">,</span>
                                        <span class="mi">1</span><span class="p">)</span>
                                    <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Creating Boto Connection region=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">region</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;StackName=&quot;</span> <span class="o">+</span> <span class="n">stackname</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;DisableRollback=True&quot;</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;TemplateURL=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">())</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Capabilities=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_capabilities</span><span class="p">())</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Parameters:&quot;</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">s_parms</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>

                    <span class="n">stackdata</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">create_stack</span><span class="p">(</span>
                        <span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">,</span>
                        <span class="n">DisableRollback</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">TemplateURL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">(),</span>
                        <span class="n">Parameters</span><span class="o">=</span><span class="n">s_parms</span><span class="p">,</span>
                        <span class="n">Capabilities</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_capabilities</span><span class="p">())</span>

                    <span class="n">testdata</span><span class="o">.</span><span class="n">add_test_stack</span><span class="p">(</span><span class="n">stackdata</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Cannot launch </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">())</span>

            <span class="n">testdata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testdata</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |{}LAUNCHING STACKS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} {}{} {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">I</span><span class="p">,</span>
                    <span class="n">header</span><span class="p">,</span>
                    <span class="n">test</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">(),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:stack&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">rst_color</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">testdata_list</span>

    <span class="k">def</span> <span class="nf">validate_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function validates the given JSON.</span>

<span class="sd">        :param jsonin: Json object to be validated</span>

<span class="sd">        :return: TRUE if given Json is valid, FALSE otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parms</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jsonin</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parms</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">validate_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function validates the parameters file of the CloudFormation template.</span>

<span class="sd">        :param taskcat_cfg: TaskCat config yaml object</span>
<span class="sd">        :param test_list: List of tests</span>

<span class="sd">        :return: TRUE if the parameters file is valid, else FALSE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">define_tests</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; |Validate JSON input in test[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;parameter_path = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span>

            <span class="n">inputparms</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span><span class="o">.</span><span class="n">text</span>
            <span class="n">jsonstatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_json</span><span class="p">(</span><span class="n">inputparms</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;jsonstatus = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">jsonstatus</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">jsonstatus</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="s2">&quot;Validated [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;parameter_file = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">())</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Cannot validate </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">regxfind</span><span class="p">(</span><span class="n">re_object</span><span class="p">,</span> <span class="n">data_line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the matching string.</span>

<span class="sd">        :param re_object: Regex object</span>
<span class="sd">        :param data_line: String to be searched</span>

<span class="sd">        :return: Matching String if found, otherwise return &#39;Not-found&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sg</span> <span class="o">=</span> <span class="n">re_object</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">data_line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sg</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Not-found&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse_stack_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary object containing the region and stack name.</span>

<span class="sd">        :param stack_name: Full stack name arn</span>
<span class="sd">        :return: Dictionary object containing the region and stack name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stack_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">region_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=:)(.\w-.+(\w*)-\d)(?=:)&#39;</span><span class="p">)</span>
        <span class="n">stack_name_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=:stack/)(tCaT.*.)(?=/)&#39;</span><span class="p">)</span>
        <span class="n">stack_info</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">region_re</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">)</span>
        <span class="n">stack_info</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">stack_name_re</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stack_info</span>

    <span class="k">def</span> <span class="nf">stackcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the stack id, this function returns the status of the stack as</span>
<span class="sd">        a list with stack name, region, and status as list items, in the respective</span>
<span class="sd">        order.</span>

<span class="sd">        :param stack_id: CloudFormation stack id</span>

<span class="sd">        :return: List containing the stack name, region and stack status in the</span>
<span class="sd">            respective order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="n">stack_id</span><span class="p">)</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
        <span class="n">stack_name</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]</span>
        <span class="n">test_info</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="c1"># noinspection PyBroadException</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_query</span> <span class="o">=</span> <span class="p">(</span><span class="n">cfn</span><span class="o">.</span><span class="n">describe_stacks</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stack_name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">test_query</span><span class="p">[</span><span class="s1">&#39;Stacks&#39;</span><span class="p">]:</span>
                <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack_name</span><span class="p">)</span>
                <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
                <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackStatus&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;StackStatus&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;CREATE_IN_PROGRESS&#39;</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackStatus&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;DELETE_IN_PROGRESS&#39;</span><span class="p">:</span>
                    <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack_name</span><span class="p">)</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;STACK_DELETED&quot;</span><span class="p">)</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">test_info</span>

    <span class="k">def</span> <span class="nf">get_stackstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of TestData objects, this function checks the stack status</span>
<span class="sd">        of each CloudFormation stack and updates the corresponding TestData object</span>
<span class="sd">        with the status.</span>

<span class="sd">        :param testdata_list: List of TestData object</span>
<span class="sd">        :param speed: Interval (in seconds) in which the status has to be checked in loop</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">active_tests</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">active_tests</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_active_tests</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;{}{} {} [{}]{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">header</span><span class="p">,</span>
                <span class="s1">&#39;AWS REGION&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
                <span class="s1">&#39;CLOUDFORMATION STACK STATUS&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
                <span class="s1">&#39;CLOUDFORMATION STACK NAME&#39;</span><span class="p">,</span>
                <span class="n">rst_color</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                    <span class="n">stackquery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackcheck</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                    <span class="n">current_active_tests</span> <span class="o">=</span> <span class="n">stackquery</span><span class="p">[</span>
                                               <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">current_active_tests</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;{3}{0} {1} [{2}]{4}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">stackquery</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
                        <span class="n">stackquery</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
                        <span class="n">stackquery</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">hightlight</span><span class="p">,</span>
                        <span class="n">rst_color</span><span class="p">))</span>
                    <span class="n">stack</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stackquery</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">active_tests</span> <span class="o">=</span> <span class="n">current_active_tests</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function deletes the CloudFormation stacks of the given tests.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>
<span class="sd">        :param speed: Interval (in seconds) in which the status has to be checked</span>
<span class="sd">            while deleting the stacks.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">docleanup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_docleanup</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;clean-up = </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">docleanup</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">docleanup</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |CLEANUP STACKS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stackdelete</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_stackstatus</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deep_cleanup</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;[Retaining Stacks (Cleanup is set to {0}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docleanup</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">deep_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function deletes the AWS resources which were not deleted</span>
<span class="sd">        by deleting CloudFormation stacks.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="n">failed_stack_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;DELETE_FAILED&#39;</span><span class="p">:</span>
                    <span class="n">failed_stack_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_stack_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;All stacks deleted successfully. Deep clean-up not required.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Few stacks failed to delete. Collecting resources for deep clean-up.&quot;</span><span class="p">)</span>
            <span class="c1"># get test region from the stack id</span>
            <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">failed_stack_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">Sweeper</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
            <span class="n">failed_stacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_resources</span><span class="p">(</span><span class="n">failed_stack_ids</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
            <span class="c1"># print all resources which failed to delete</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Resources which failed to delete:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">failed_stack</span> <span class="ow">in</span> <span class="n">failed_stacks</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Stack Id: &quot;</span> <span class="o">+</span> <span class="n">failed_stack</span><span class="p">[</span><span class="s1">&#39;stackId&#39;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">failed_stack</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;{0} = {1}, {2} = {3}, {4} = {5}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">LogicalId&#39;</span><span class="p">,</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logicalId&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">PhysicalId&#39;</span><span class="p">,</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;physicalId&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">Type&#39;</span><span class="p">,</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resourceType&#39;</span><span class="p">)</span>
                        <span class="p">))</span>
                <span class="n">s</span><span class="o">.</span><span class="n">delete_all</span><span class="p">(</span><span class="n">failed_stacks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stackdelete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function deletes the CloudFormation stacks of the given tests.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
                <span class="n">stack_name</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]</span>
                <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
                <span class="n">cfn</span><span class="o">.</span><span class="n">delete_stack</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stack_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">if_stackexists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function checks if a stack exist with the given stack name.</span>
<span class="sd">        Returns &quot;yes&quot; if exist, otherwise &quot;no&quot;.</span>

<span class="sd">        :param stackname: Stack name</span>
<span class="sd">        :param region: AWS region</span>

<span class="sd">        :return: &quot;yes&quot; if stack exist, otherwise &quot;no&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cfn</span><span class="o">.</span><span class="n">describe_stacks</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
            <span class="n">exists</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">exists</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Successfully Deleted[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">stackname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exists</span>

    <span class="k">def</span> <span class="nf">define_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yamlc</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function reads the given test config yaml object and defines</span>
<span class="sd">        the tests as per the given config object.</span>

<span class="sd">        :param yamlc: TaskCat config yaml object</span>
<span class="sd">        :param test: Test scenarios</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tdefs</span> <span class="ow">in</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># print(&quot;[DEBUG] tdefs = %s&quot; % tdefs)</span>
            <span class="k">if</span> <span class="n">tdefs</span> <span class="o">==</span> <span class="n">test</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;template_file&#39;</span><span class="p">]</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;parameter_input&#39;</span><span class="p">]</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;qsname&#39;</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">()</span>

                <span class="c1"># Checks if cleanup flag is set</span>
                <span class="c1"># If cleanup is set to &#39;false&#39; stack will not be deleted after</span>
                <span class="c1"># launch attempt</span>
                <span class="k">if</span> <span class="s1">&#39;cleanup&#39;</span> <span class="ow">in</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cleanupstack</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;cleanup&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">cleanupstack</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;cleanup set to ymal value&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">set_docleanup</span><span class="p">(</span><span class="n">cleanupstack</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Cleanup value set to (false)&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_docleanup</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># By default do cleanup unless self.run_cleanup</span>
                    <span class="c1"># was overwridden (set to False) by -n flag</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;cleanup set by cli flag {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_docleanup</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;No cleanup value set&quot;</span><span class="p">)</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot; - (Defaulting to cleanup)&quot;</span><span class="p">)</span>

                <span class="c1"># Load test setting</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_s3bucket</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_project</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_template_file</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_file</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_template_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">()))</span>

                <span class="c1"># Check to make sure template filenames are correct</span>
                <span class="n">template_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">template_path</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Could not locate {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Check to make sure filename is correct?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">()))</span>
                    <span class="n">quit</span><span class="p">()</span>

                <span class="c1"># Check to make sure parameter filenames are correct</span>
                <span class="n">parameter_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parameter_path</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Could not locate {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">()))</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Check to make sure filename is correct?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">()))</span>
                    <span class="n">quit</span><span class="p">()</span>

                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;|Acquiring tests assets for .......[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|S3 Bucket  =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">())</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Project    =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">())</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Template   =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">())</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Parameter  =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span>
                <span class="k">if</span> <span class="s1">&#39;regions&#39;</span> <span class="ow">in</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">r</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_test_region</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Defined Regions:&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">list_o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_region</span><span class="p">():</span>
                                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="s2"> - [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">list_o</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">global_regions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_region</span><span class="p">(</span><span class="n">yamlc</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_test_region</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">global_regions</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Global Regions:&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">list_o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_region</span><span class="p">():</span>
                            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="s2"> - [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">list_o</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="s2">&quot;(Completed) acquisition of [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Set AWS Credentials</span>
    <span class="k">def</span> <span class="nf">aws_api_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function reads the AWS credentials from various sources to ensure</span>
<span class="sd">        that the client has right credentials defined to successfully run</span>
<span class="sd">        TaskCat against an AWS account.</span>

<span class="sd">        :param args: Command line arguments for AWS credentials. It could be</span>
<span class="sd">            either profile name, access key and secret key or none.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">boto_profile</span><span class="p">:</span>
            <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span><span class="n">profile_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">boto_profile</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sts_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
                <span class="n">account</span> <span class="o">=</span> <span class="n">sts_client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :AWS AccountNumber: </span><span class="se">\t</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Authenticated via: </span><span class="se">\t</span><span class="s2"> [boto-profile] &quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Credential Error - Please check you profile!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span><span class="p">:</span>
            <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span>
                <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span><span class="p">,</span>
                <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sts_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
                <span class="n">account</span> <span class="o">=</span> <span class="n">sts_client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :AWS AccountNumber: </span><span class="se">\t</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Authenticated via: </span><span class="se">\t</span><span class="s2"> [role] &quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Credential Error - Please check you keys!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span>
                <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span><span class="p">,</span>
                <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sts_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
                <span class="n">account</span> <span class="o">=</span> <span class="n">sts_client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :AWS AccountNumber: </span><span class="se">\t</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Authenticated via: </span><span class="se">\t</span><span class="s2"> [role] &quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Credential Error - Cannot assume role!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function validates the given yaml file.</span>

<span class="sd">        :param yaml_file: Yaml file name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">run_tests</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">required_global_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;qsname&#39;</span><span class="p">,</span>
            <span class="s1">&#39;owner&#39;</span><span class="p">,</span>
            <span class="s1">&#39;reporting&#39;</span><span class="p">,</span>
            <span class="s1">&#39;regions&#39;</span>
        <span class="p">]</span>

        <span class="n">required_test_parameters</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;template_file&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parameter_input&#39;</span>
        <span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Reading Config form: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">))</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">checkyaml</span><span class="p">:</span>
                    <span class="n">cfg_yml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">checkyaml</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_global_keys</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;global:</span><span class="si">%s</span><span class="s2"> missing from &quot;</span> <span class="o">%</span> <span class="n">key</span> <span class="o">+</span> <span class="n">yaml_file</span><span class="p">)</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">run_tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">defined</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; |Queing test =&gt; </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">defined</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">parms</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">defined</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_test_parameters</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">defined</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="k">pass</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No key </span><span class="si">%s</span><span class="s2"> in test&quot;</span> <span class="o">%</span> <span class="n">key</span> <span class="o">+</span> <span class="n">defined</span><span class="p">)</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;While inspecting: &quot;</span> <span class="o">+</span> <span class="n">parms</span><span class="p">)</span>
                                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Cannot open [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">yaml_file</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;config.yml [</span><span class="si">%s</span><span class="s2">] is not formatted well!!&quot;</span> <span class="o">%</span> <span class="n">yaml_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">run_tests</span>

    <span class="k">def</span> <span class="nf">genreport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">dashboard_filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function generates the test report.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>
<span class="sd">        :param dashboard_filename: Report file name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">yattag</span><span class="o">.</span><span class="n">Doc</span><span class="p">()</span>

        <span class="c1"># Type of cfnlog return cfn log file</span>
        <span class="c1"># Type of resource_log return resource log file</span>
        <span class="k">def</span> <span class="nf">getofile</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">):</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
            <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s1">&#39;cfnlog&#39;</span><span class="p">:</span>
                <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;{}-{}-{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack_name</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="s1">&#39;cfnlogs&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s1">&#39;resource_log&#39;</span><span class="p">:</span>
                <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;{}-{}-{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack_name</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_teststate</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
            <span class="c1"># Add try catch and return MANUALLY_DELETED</span>
            <span class="c1"># Add css test-orange</span>
            <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
            <span class="n">test_query</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">describe_stacks</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
            <span class="n">rstatus</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">status_css</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">test_query</span><span class="p">[</span><span class="s1">&#39;Stacks&#39;</span><span class="p">]:</span>
                <span class="n">rstatus</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackStatus&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rstatus</span> <span class="o">==</span> <span class="s1">&#39;CREATE_COMPLETE&#39;</span><span class="p">:</span>
                    <span class="n">status_css</span> <span class="o">=</span> <span class="s1">&#39;class=test-green&#39;</span>
                <span class="k">elif</span> <span class="n">rstatus</span> <span class="o">==</span> <span class="s1">&#39;CREATE_FAILED&#39;</span><span class="p">:</span>
                    <span class="n">status_css</span> <span class="o">=</span> <span class="s1">&#39;class=test-red&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">status_css</span> <span class="o">=</span> <span class="s1">&#39;class=test-red&#39;</span>
            <span class="k">return</span> <span class="n">rstatus</span><span class="p">,</span> <span class="n">status_css</span>

        <span class="n">tag</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">tag</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">text</span>
        <span class="n">logo</span> <span class="o">=</span> <span class="s1">&#39;taskcat&#39;</span>
        <span class="n">repo_link</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/aws-quickstart/taskcat&#39;</span>
        <span class="n">output_css</span> <span class="o">=</span> <span class="s1">&#39;https://taskcat.s3.amazonaws.com/assets/css/taskcat.css&#39;</span>
        <span class="n">doc_link</span> <span class="o">=</span> <span class="s1">&#39;http://taskcat.io&#39;</span>

        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">):</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span>
                    <span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;width=device-width&quot;</span><span class="p">)</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="s1">&#39;stylesheet&#39;</span><span class="p">,</span>
                         <span class="n">href</span><span class="o">=</span><span class="n">output_css</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">):</span>
                    <span class="n">text</span><span class="p">(</span><span class="s1">&#39;TaskCat Report&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">):</span>
                <span class="n">tested_on</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%A - %b,</span><span class="si">%d</span><span class="s1">,%Y @ %H:%M:%S&#39;</span><span class="p">)</span>

                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;class=header-table-fill&#39;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">):</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span> <span class="s1">&#39;colspan=2&#39;</span><span class="p">):</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">):</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">repo_link</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="s1">&#39;GitHub Repo: &#39;</span><span class="p">)</span>
                                        <span class="n">text</span><span class="p">(</span><span class="n">repo_link</span><span class="p">)</span>
                                        <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;br&#39;</span><span class="p">)</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">doc_link</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Documentation: &#39;</span><span class="p">)</span>
                                        <span class="n">text</span><span class="p">(</span><span class="n">doc_link</span><span class="p">)</span>
                                        <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;br&#39;</span><span class="p">)</span>
                                    <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Tested on: &#39;</span><span class="p">)</span>
                                    <span class="n">text</span><span class="p">(</span><span class="n">tested_on</span><span class="p">)</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;class=taskcat-logo&#39;</span><span class="p">):</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;class=table-fill&#39;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;thread&#39;</span><span class="p">):</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-center&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=25%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Test Name&#39;</span><span class="p">)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=10%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Tested Region&#39;</span><span class="p">)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=30%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Stack Name&#39;</span><span class="p">)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=20%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Tested Results&#39;</span><span class="p">)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=15%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Test Logs&#39;</span><span class="p">)</span>

                            <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">,</span> <span class="s1">&#39;class= test-footer&#39;</span><span class="p">):</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;colspan=5&#39;</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                                <span class="n">testname</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">()</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;(Generating Reports)&quot;</span><span class="p">)</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot; - Processing {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testname</span><span class="p">))</span>
                                <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                                    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                                    <span class="n">status</span><span class="p">,</span> <span class="n">css</span> <span class="o">=</span> <span class="n">get_teststate</span><span class="p">(</span>
                                        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">],</span>
                                        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>

                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;class=test-info&#39;</span><span class="p">):</span>
                                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">):</span>
                                                <span class="n">text</span><span class="p">(</span><span class="n">testname</span><span class="p">)</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">):</span>
                                            <span class="n">text</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">):</span>
                                            <span class="n">text</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">])</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="n">css</span><span class="p">):</span>
                                            <span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">):</span>
                                            <span class="n">clog</span> <span class="o">=</span> <span class="n">getofile</span><span class="p">(</span>
                                                <span class="n">state</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">],</span>
                                                <span class="n">state</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">],</span>
                                                <span class="s1">&#39;cfnlog&#39;</span><span class="p">)</span>
                                            <span class="c1"># rlog = getofile(</span>
                                            <span class="c1">#    state[&#39;region&#39;],</span>
                                            <span class="c1">#    state[&#39;stack_name&#39;],</span>
                                            <span class="c1">#    &#39;resource_log&#39;)</span>
                                            <span class="c1">#</span>
                                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">clog</span><span class="p">):</span>
                                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;View Logs &#39;</span><span class="p">)</span>
                                                <span class="c1"># with tag(&#39;a&#39;, href=rlog):</span>
                                                <span class="c1">#    text(&#39;Resource Logs &#39;)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">,</span> <span class="s1">&#39;class= test-footer&#39;</span><span class="p">):</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;colspan=5&#39;</span><span class="p">):</span>
                                    <span class="n">vtag</span> <span class="o">=</span> <span class="s1">&#39;Generated by {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;taskcat&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
                                    <span class="n">text</span><span class="p">(</span><span class="n">vtag</span><span class="p">)</span>

                        <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">htmloutput</span> <span class="o">=</span> <span class="n">yattag</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
                                   <span class="n">indentation</span><span class="o">=</span><span class="s1">&#39;    &#39;</span><span class="p">,</span>
                                   <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                   <span class="n">indent_text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dashboard_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">htmloutput</span><span class="p">)</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">htmloutput</span>

    <span class="k">def</span> <span class="nf">collect_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function collects the AWS resources information created by the</span>
<span class="sd">        CloudFormation stack for generating the report.</span>

<span class="sd">        :param testdata_list: List of TestData object</span>
<span class="sd">        :param logpath: Log file path</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;(Collecting Resources)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="n">stackinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                <span class="c1"># Get stack resources</span>
                <span class="n">resource</span><span class="p">[</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
                <span class="n">test_logpath</span> <span class="o">=</span> <span class="s1">&#39;{}/{}-{}-{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">logpath</span><span class="p">,</span>
                    <span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">],</span>
                    <span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;resources&#39;</span><span class="p">,</span>
                    <span class="n">extension</span><span class="p">)</span>

                <span class="c1"># Write resource logs</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">test_logpath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                        <span class="n">resource</span><span class="p">,</span>
                        <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                        <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))))</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_cfnlogs</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns the event logs of the given stack in a specific format.</span>
<span class="sd">        :param stackname: Name of the stack</span>
<span class="sd">        :param region: Region stack belongs to</span>
<span class="sd">        :return: Event logs of the stack</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Collecting logs for &quot;</span> <span class="o">+</span> <span class="n">stackname</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Collect stack_events</span>
        <span class="n">stack_events</span> <span class="o">=</span> <span class="n">get_cfn_stack_events</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="c1"># Uncomment line for debug</span>
        <span class="c1"># pprint.pprint (stack_events)</span>
        <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">stack_events</span><span class="p">:</span>
            <span class="n">event_details</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TimeStamp&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;ResourceStatus&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ResourceStatus&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;ResourceType&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">]}</span>
            <span class="k">if</span> <span class="s1">&#39;ResourceStatusReason&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
                <span class="n">event_details</span><span class="p">[</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">event_details</span><span class="p">[</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_details</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">events</span>

    <span class="k">def</span> <span class="nf">createcfnlogs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function creates the CloudFormation log files.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>
<span class="sd">        :param logpath: Log file path</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;(Collecting CloudFormation Logs)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="n">stackinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                <span class="n">stackname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">])</span>
                <span class="n">region</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
                <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
                <span class="n">test_logpath</span> <span class="o">=</span> <span class="s1">&#39;{}/{}-{}-{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">logpath</span><span class="p">,</span>
                    <span class="n">stackname</span><span class="p">,</span>
                    <span class="n">region</span><span class="p">,</span>
                    <span class="s1">&#39;cfnlogs&#39;</span><span class="p">,</span>
                    <span class="n">extension</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_logs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]),</span> <span class="n">test_logpath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_id</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the event logs of the given stack and all the child stacks to a given file.</span>
<span class="sd">        :param stack_id: Stack Id</span>
<span class="sd">        :param logpath: Log file path</span>
<span class="sd">        :return: </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stackinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack_id</span><span class="p">))</span>
        <span class="n">stackname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">])</span>
        <span class="n">region</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>

        <span class="c1"># Get stack resources</span>
        <span class="n">cfnlogs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cfnlogs</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cfnlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ResourceStatus&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;CREATE_COMPLETE&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ResourceStatusReason&#39;</span> <span class="ow">in</span> <span class="n">cfnlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="n">cfnlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;Stack launch was successful&quot;</span>

        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |StackName: &quot;</span> <span class="o">+</span> <span class="n">stackname</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |Region: &quot;</span> <span class="o">+</span> <span class="n">region</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |Logging to: &quot;</span> <span class="o">+</span> <span class="n">logpath</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |Tested on: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, </span><span class="si">%d</span><span class="s2">. %B %Y %I:%M%p&quot;</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;------------------------------------------------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;ResourceStatusReason: &quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reason</span><span class="p">),</span> <span class="mi">85</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;==========================================================================================&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logpath</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log_output</span><span class="p">:</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Region: &quot;</span> <span class="o">+</span> <span class="n">region</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;StackName: &quot;</span> <span class="o">+</span> <span class="n">stackname</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ResourceStatusReason:  </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reason</span><span class="p">),</span> <span class="mi">85</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Events:  </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">cfnlogs</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">))</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Tested on: &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, </span><span class="si">%d</span><span class="s2">. %B %Y %I:%M%p&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;-----------------------------------------------------------------------------</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Collect resources of the stack and get event logs for any child stacks</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">include_stacks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resource</span><span class="p">[</span><span class="s1">&#39;resourceType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AWS::CloudFormation::Stack&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_logs</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;physicalId&#39;</span><span class="p">],</span> <span class="n">logpath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">createreport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function creates the test report.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>
<span class="sd">        :param filename: Report file name</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">o_directory</span> <span class="o">=</span> <span class="s1">&#39;taskcat_outputs&#39;</span>

        <span class="c1"># noinspection PyBroadException</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">o_directory</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">o_directory</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |GENERATING REPORTS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Creating report in [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">o_directory</span><span class="p">)</span>
        <span class="n">dashboard_filename</span> <span class="o">=</span> <span class="n">o_directory</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>

        <span class="c1"># Collect recursive logs</span>
        <span class="c1"># file path is already setup by getofile function in genreports</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createcfnlogs</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">,</span> <span class="n">o_directory</span><span class="p">)</span>

        <span class="c1"># Generate html test dashboard</span>
        <span class="c1"># Uses logpath + region to create View Logs link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genreport</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">,</span> <span class="n">dashboard_filename</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Multi-Region CloudFormation Deployment Tool)</span>
<span class="s2">            </span>
<span class="s2">    [Auto-generated stack inputs] </span>
<span class="s2">    Auto-select available az</span><span class="se">\&#39;</span><span class="s2">s at runtime based test region defined $[_genazX] $[_genaz&lt;number of az</span><span class="se">\&#39;</span><span class="s2">s&gt;] </span>
<span class="s2">    Generate password during runtime $[_genpass_XX]  $[_genpass_&lt;length&gt;_&lt;type&gt;]</span>
<span class="s2">        - Parameters value in json input file must start with </span><span class="se">\&#39;</span><span class="s2">$[</span><span class="se">\&#39;</span><span class="s2"> end with </span><span class="se">\&#39;</span><span class="s2">]</span><span class="se">\&#39;</span><span class="s2"></span>
<span class="s2">    </span>
<span class="s2">    Example:[ {</span>
<span class="s2">        &quot;ParameterKey&quot;: &quot;AvailabilityZones&quot;,</span>
<span class="s2">        &quot;ParameterValue&quot;: &quot;$[taskcat_genaz_2]&quot;</span>
<span class="s2">    } ]</span>
<span class="s2">    Generates: us-east-1a, us-east-2b</span>
<span class="s2">    </span>
<span class="s2">    Example:[ {</span>
<span class="s2">        &quot;ParameterKey&quot;: &quot;AppPassword&quot;,</span>
<span class="s2">        &quot;ParameterValue&quot;: &quot;$[taskcat_genpass_8]&quot;</span>
<span class="s2">    } ]</span>
<span class="s2">    </span>
<span class="s2">    Generates: tI8zN3iX8 </span>
<span class="s2">    Optionally: $[taskcat_genpass_8S]</span>
<span class="s2">    Generates: mA5@cB5!</span>
<span class="s2">    </span>
<span class="s2">    For more info see: http://taskcat.io</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">prog</span><span class="o">=</span><span class="s1">&#39;taskcat&#39;</span><span class="p">,</span>
            <span class="n">prefix_chars</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
            <span class="n">formatter_class</span><span class="o">=</span><span class="n">RawTextHelpFormatter</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--config_yml&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(Required!) [config.yml] pass &#39;-ey&#39; for example&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-P&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--boto_profile&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Authenticate using boto profile&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-A&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--aws_access_key&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;AWS Access Key&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-S&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--aws_secret_key&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;AWS Secrect Key&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-ey&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--example_yaml&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print out example yaml&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-n&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--no_cleanup&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Sets cleanup to false (Does not teardown stacks)&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--verbose&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enables verbosity&quot;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">())</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">example_yaml</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;#An example: config.yml file to be used with </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="vm">__name__</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">yaml_cfg</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># Overrides Defaults for cleanup but does not overwrite config.yml</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">no_cleanup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">boto_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot use boto profile -P (--boto_profile)&quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;with --aws_access_key or --aws_secret_key&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">())</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">welcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog_name</span><span class="o">=</span><span class="s1">&#39;taskcat.io&#39;</span><span class="p">):</span>
        <span class="n">banner</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="o">.</span><span class="n">Figlet</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="n">banner</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">banner</span><span class="o">.</span><span class="n">renderText</span><span class="p">(</span><span class="n">prog_name</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;version </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">version</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_cfn_stack_events</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a stack name and the region, this function returns the event logs of the given stack, as list.</span>
<span class="sd">    :param stackname: Name of the stack</span>
<span class="sd">    :param region: Region stack belongs to</span>
<span class="sd">    :return: Event logs of the stack</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cfn_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    <span class="n">stack_events</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">cfn_client</span><span class="o">.</span><span class="n">describe_stack_events</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
        <span class="n">stack_events</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;StackEvents&#39;</span><span class="p">])</span>
        <span class="k">while</span> <span class="s1">&#39;NextToken&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">cfn_client</span><span class="o">.</span><span class="n">describe_stack_events</span><span class="p">(</span><span class="n">NextToken</span><span class="o">=</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;NextToken&#39;</span><span class="p">],</span> <span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
            <span class="n">stack_events</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;StackEvents&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} Error trying to get the events for stack [{}] in region [{}]</span><span class="se">\b</span><span class="s2"> {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">E</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">stackname</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">region</span><span class="p">),</span>
            <span class="n">e</span>
        <span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">stack_events</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">pass</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">


    <h2 class="section-title" id="header-classes">Classes</h2>

      <div class="item">
      <p id="taskcat.TaskCat" class="name">class <span class="ident">TaskCat</span></p>


  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TaskCat</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># CONSTRUCTOR</span>
    <span class="c1"># ============</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nametag</span><span class="o">=</span><span class="s1">&#39;[taskcat]&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">=</span> <span class="s1">&#39;{1}{0}{2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nametag</span><span class="p">,</span> <span class="n">name_color</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="s1">&#39;config.yml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defult_region</span> <span class="o">=</span> <span class="s2">&quot;us-east-1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_template_file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_termsize</span> <span class="o">=</span> <span class="mi">110</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_banner</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_global</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1"># SETTERS AND GETTERS</span>
    <span class="c1"># ===================</span>

    <span class="k">def</span> <span class="nf">set_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>

    <span class="k">def</span> <span class="nf">get_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

    <span class="k">def</span> <span class="nf">set_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ability</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ability</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span>

    <span class="k">def</span> <span class="nf">set_s3bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="o">=</span> <span class="n">bucket</span>

    <span class="k">def</span> <span class="nf">get_s3bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_yml</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">config_yml</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config_yml</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Cannot locate file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">config_yml</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>

    <span class="k">def</span> <span class="nf">get_template_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_file</span>

    <span class="k">def</span> <span class="nf">set_template_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_template_file</span> <span class="o">=</span> <span class="n">template</span>

    <span class="k">def</span> <span class="nf">set_parameter_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_file</span> <span class="o">=</span> <span class="n">parameter</span>

    <span class="k">def</span> <span class="nf">get_parameter_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_file</span>

    <span class="k">def</span> <span class="nf">set_parameter_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span> <span class="o">=</span> <span class="n">parameter</span>

    <span class="k">def</span> <span class="nf">get_parameter_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span>

    <span class="k">def</span> <span class="nf">set_template_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span> <span class="o">=</span> <span class="n">template</span>

    <span class="k">def</span> <span class="nf">get_template_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span>

    <span class="k">def</span> <span class="nf">set_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="n">password</span>

    <span class="k">def</span> <span class="nf">get_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_password</span>

    <span class="k">def</span> <span class="nf">set_default_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defult_region</span> <span class="o">=</span> <span class="n">region</span>

    <span class="k">def</span> <span class="nf">get_default_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defult_region</span>

    <span class="k">def</span> <span class="nf">get_test_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span>

    <span class="k">def</span> <span class="nf">set_test_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">region_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_docleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cleanup_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span> <span class="o">=</span> <span class="n">cleanup_value</span>

    <span class="k">def</span> <span class="nf">get_docleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span>

    <span class="c1">#      FUNCTIONS       #</span>
    <span class="c1"># ==================== #</span>

    <span class="k">def</span> <span class="nf">stage_in_s3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upload templates and other artifacts to s3.</span>

<span class="sd">        This function creates the s3 bucket with name provided in the config yml file. If</span>
<span class="sd">        no bucket name provided, it creates the s3 bucket using project name provided in</span>
<span class="sd">        config yml file. And uploads the templates and other artifacts to the s3 bucket.</span>

<span class="sd">        :param taskcat_cfg: Taskcat configuration provided in yml file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |CONTENTS OF  S3 BUCKET{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>

        <span class="n">project</span> <span class="o">=</span> <span class="n">taskcat_cfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;qsname&#39;</span><span class="p">]</span>

        <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;s3bucket&#39;</span> <span class="ow">in</span> <span class="n">taskcat_cfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;s3bucket&#39;</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Staging Bucket =&gt; &quot;</span> <span class="o">+</span> <span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_s3bucket</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">auto_bucket</span> <span class="o">=</span> <span class="s1">&#39;taskcat-&#39;</span> <span class="o">+</span> <span class="n">project</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">jobid</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Staging Bucket =&gt; &quot;</span> <span class="o">+</span> <span class="n">auto_bucket</span><span class="p">)</span>
            <span class="n">s3</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">auto_bucket</span><span class="p">)</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">auto_bucket</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_s3bucket</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_project</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">project</span><span class="p">):</span>
            <span class="n">fsmap</span> <span class="o">=</span> <span class="n">buildmap</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">project</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">example1</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            # Name of example project = [projectx]</span>
<span class="s1">            # Command issued to run taskcat = taskcat.py -c projectx/ci/config.yml</span>
<span class="s1">            Hint: if taskcat.py is not in your path specify the full path to taskcat.py</span>
<span class="s1">            </span>
<span class="s1">            # Example of expected directory/project structure</span>
<span class="s1">            projectx</span>
<span class="s1">             LICENSE.txt</span>
<span class="s1">             ci</span>
<span class="s1">              taskcat.yml         # TaskCat Configuration file</span>
<span class="s1">              projectx-input.json # Inputs to pass during stackcreation</span>
<span class="s1">             scripts</span>
<span class="s1">              project-userdata.sh # Any scripts that is part of this project</span>
<span class="s1">             templates</span>
<span class="s1">                 projectx.template</span>

<span class="s1">            # Contents of taskcat.yml</span>
<span class="s1">            global:</span>
<span class="s1">              qsname: projectx</span>
<span class="s1">              regions:</span>
<span class="s1">                - us-east-1</span>
<span class="s1">                - us-west-1</span>
<span class="s1">                - us-west-2</span>
<span class="s1">             </span>
<span class="s1">            tests:</span>
<span class="s1">              projectx-test:</span>
<span class="s1">                template_file: projectx.template</span>
<span class="s1">                parameter_input: projectx-input.json</span>
<span class="s1">                &#39;&#39;&#39;</span>

            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\t\t</span><span class="s1"> Hint: The name specfied as value of qsname ({})</span>
<span class="s1">                    must match the root directory of your project&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}!Cannot find directory [{1}] in {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">    Example:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">example1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Please cd to where you project is located&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">fsmap</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">upload</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;^./&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="n">bucket</span><span class="o">.</span><span class="n">Acl</span><span class="p">()</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">ACL</span><span class="o">=</span><span class="s1">&#39;public-read&#39;</span><span class="p">)</span>
                <span class="n">bucket</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                                   <span class="n">upload</span><span class="p">,</span>
                                   <span class="n">ExtraArgs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ACL&#39;</span><span class="p">:</span> <span class="s1">&#39;public-read&#39;</span><span class="p">})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Cannot Upload to bucket =&gt; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Check that you bucketname is correct&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">o</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;{0}/{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_available_azs</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of availability zones in a given region.</span>

<span class="sd">        :param region: Region for the availability zones</span>
<span class="sd">        :param count: Minimum number of availability zones needed</span>

<span class="sd">        :return: List of availability zones in a given region</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">available_azs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
        <span class="n">availability_zones</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_availability_zones</span><span class="p">(</span>
            <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;Values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]}])</span>

        <span class="k">for</span> <span class="n">az</span> <span class="ow">in</span> <span class="n">availability_zones</span><span class="p">[</span><span class="s1">&#39;AvailabilityZones&#39;</span><span class="p">]:</span>
            <span class="n">available_azs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">az</span><span class="p">[</span><span class="s1">&#39;ZoneName&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_azs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}!Only {1} az&#39;s are available in {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_azs</span><span class="p">),</span> <span class="n">region</span><span class="p">))</span>
            <span class="n">quit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">azs</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available_azs</span><span class="p">[:</span><span class="n">count</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">azs</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_s3contents</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">payload</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span> <span class="nf">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns S3 url of a given object.</span>

<span class="sd">        :param key: Name of the object whose S3 url is being returned</span>
<span class="sd">        :return: S3 url of the given key</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="s1">&#39;s3v4&#39;</span><span class="p">))</span>

        <span class="n">bucket_location</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_bucket_location</span><span class="p">(</span>
            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span>
                                     <span class="n">Prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">())</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Contents&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s3obj</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">s3obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Key&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="c1"># Finding exact match</span>
                        <span class="n">terms</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">terms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">bucket_location</span><span class="p">[</span>
                                <span class="s1">&#39;LocationConstraint&#39;</span>
                            <span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="n">o_url</span> <span class="o">=</span> <span class="s2">&quot;https://s3-{0}.{1}/{2}/{3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">bucket_location</span><span class="p">[</span><span class="s1">&#39;LocationConstraint&#39;</span><span class="p">],</span>
                                    <span class="s2">&quot;amazonaws.com&quot;</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span>
                                    <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">return</span> <span class="n">o_url</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">amzns3</span> <span class="o">=</span> <span class="s1">&#39;s3.amazonaws.com&#39;</span>
                                <span class="n">o_url</span> <span class="o">=</span> <span class="s2">&quot;https://{0}/{1}/{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amzns3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">return</span> <span class="n">o_url</span>

    <span class="k">def</span> <span class="nf">get_global_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yamlcfg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of regions defined under global region in the yml config file.</span>

<span class="sd">        :param yamlcfg: Content of the yml config file</span>
<span class="sd">        :return: List of regions</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g_regions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">yamlcfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;region&#39;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">iter</span><span class="p">(</span><span class="n">yamlcfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">])</span>
                    <span class="n">namespace</span> <span class="o">=</span> <span class="s1">&#39;global&#39;</span>
                    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">yamlcfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">]:</span>
                        <span class="c1"># print(&quot;found region %s&quot; % region)</span>
                        <span class="n">g_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_use_global</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No regions defined in [</span><span class="si">%s</span><span class="s2">]:&quot;</span> <span class="o">%</span> <span class="n">namespace</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Please correct region defs[</span><span class="si">%s</span><span class="s2">]:&quot;</span> <span class="o">%</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g_regions</span>

    <span class="k">def</span> <span class="nf">get_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">include_stacks</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a stackname, and region function returns the list of dictionary items, where each item</span>
<span class="sd">        consist of logicalId, physicalId and resourceType of the aws resource associated</span>
<span class="sd">        with the stack.</span>

<span class="sd">        :param include_stacks: </span>
<span class="sd">        :param stackname: CloudFormation stack name</span>
<span class="sd">        :param region: AWS region</span>
<span class="sd">        :return: List of objects in the following format</span>
<span class="sd">             [</span>
<span class="sd">                 {</span>
<span class="sd">                     &#39;logicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                     &#39;physicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                     &#39;resourceType&#39;: &#39;String&#39;</span>
<span class="sd">                 },</span>
<span class="sd">             ]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l_resources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_resources_helper</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">l_resources</span><span class="p">,</span> <span class="n">include_stacks</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l_resources</span>

    <span class="k">def</span> <span class="nf">get_resources_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">l_resources</span><span class="p">,</span> <span class="n">include_stacks</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a helper function of get_resources function. Check get_resources function for details.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stackname</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                    <span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">describe_stack_resources</span><span class="p">(</span>
                    <span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
                <span class="n">stackresources</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackResources&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">stackresources</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Resources: for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stackname</span><span class="p">))</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;{0} = {1}, {2} = {3}, {4} = {5}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">LogicalId&#39;</span><span class="p">,</span>
                            <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">PhysicalId&#39;</span><span class="p">,</span>
                            <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">Type&#39;</span><span class="p">,</span>
                            <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">)</span>
                        <span class="p">))</span>
                    <span class="c1"># if resource is a stack and has a physical resource id (NOTE: physical id will be missing if stack creation is failed)</span>
                    <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="s1">&#39;ResourceType&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;AWS::CloudFormation::Stack&#39;</span> <span class="ow">and</span> <span class="s1">&#39;PhysicalResourceId&#39;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">include_stacks</span><span class="p">:</span>
                            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">),</span>
                                 <span class="s1">&#39;physicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span>
                                 <span class="s1">&#39;resourceType&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">)}</span>
                            <span class="n">l_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                        <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">)))</span>
                        <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_resources_helper</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span> <span class="n">region</span><span class="p">,</span> <span class="n">l_resources</span><span class="p">,</span>
                                                  <span class="n">include_stacks</span><span class="p">)</span>
                    <span class="c1"># else if resource is not a stack and has a physical resource id (NOTE: physical id will be missing if stack creation is failed)</span>
                    <span class="k">elif</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="s1">&#39;ResourceType&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;AWS::CloudFormation::Stack&#39;</span> <span class="ow">and</span> <span class="s1">&#39;PhysicalResourceId&#39;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;physicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;resourceType&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">)}</span>
                        <span class="n">l_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Unable to get resources for stack </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stackname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_all_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackids</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of stackids, function returns the list of dictionary items, where each</span>
<span class="sd">        item consist of stackId and the resources associated with that stack.</span>

<span class="sd">        :param stackids: List of Stack Ids</span>
<span class="sd">        :param region: AWS region</span>
<span class="sd">        :return: A list of dictionary object in the following format</span>
<span class="sd">                [</span>
<span class="sd">                    {</span>
<span class="sd">                        &#39;stackId&#39;: &#39;string&#39;,</span>
<span class="sd">                        &#39;resources&#39;: [</span>
<span class="sd">                            {</span>
<span class="sd">                               &#39;logicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                               &#39;physicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                               &#39;resourceType&#39;: &#39;String&#39;</span>
<span class="sd">                            },</span>
<span class="sd">                        ]</span>
<span class="sd">                    },</span>
<span class="sd">                ]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l_all_resources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">anId</span> <span class="ow">in</span> <span class="n">stackids</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;stackId&#39;</span><span class="p">:</span> <span class="n">anId</span><span class="p">,</span>
                <span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span><span class="n">anId</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">l_all_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l_all_resources</span>

    <span class="k">def</span> <span class="nf">validate_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns TRUE if all the template files are valid, otherwise FALSE.</span>

<span class="sd">        :param taskcat_cfg: TaskCat config object</span>
<span class="sd">        :param test_list: List of tests</span>

<span class="sd">        :return: TRUE if templates are valid, else FALSE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load global regions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_test_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_region</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Validate Template in test[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">define_tests</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Default region [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_region</span><span class="p">())</span>
                <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_region</span><span class="p">())</span>
                <span class="n">cfn</span><span class="o">.</span><span class="n">validate_template</span><span class="p">(</span><span class="n">TemplateURL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">validate_template</span><span class="p">(</span><span class="n">TemplateURL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
                <span class="k">print</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="s2">&quot;Validated [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">())</span>
                <span class="n">cfn_result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">])</span>
                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Description  [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">cfn_result</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">cfn_params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Parameters:&quot;</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">cfn_params</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Cannot validate </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">genpassword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pass_length</span><span class="p">,</span> <span class="n">pass_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a password of given length and type.</span>

<span class="sd">        :param pass_length: Length of the desired password</span>
<span class="sd">        :param pass_type: Type of the desired password - String only OR Alphanumeric</span>
<span class="sd">            * A = AlphaNumeric, Example &#39;vGceIP8EHC&#39;</span>
<span class="sd">        :return: Password of given length and type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Auto generating password&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass size =&gt; {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pass_length</span><span class="p">))</span>

        <span class="n">password</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="s2">&quot;1234567890&quot;</span>
        <span class="n">lowercase</span> <span class="o">=</span> <span class="s2">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
        <span class="n">uppercase</span> <span class="o">=</span> <span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
        <span class="n">specialchars</span> <span class="o">=</span> <span class="s2">&quot;!#$&amp;{*:[=,]-_%@+&quot;</span>

        <span class="c1"># Generates password string with:</span>
        <span class="c1"># lowercase,uppercase and numeric chars</span>
        <span class="k">if</span> <span class="n">pass_type</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass type =&gt; {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;alpha-numeric&#39;</span><span class="p">))</span>

            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pass_length</span><span class="p">:</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lowercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">uppercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>

        <span class="c1"># Generates password string with:</span>
        <span class="c1"># lowercase,uppercase, numbers and special chars</span>
        <span class="k">elif</span> <span class="n">pass_type</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass type =&gt; (&#39;specialchars&#39;)&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pass_length</span><span class="p">:</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lowercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">uppercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">specialchars</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If no passtype is defined (None)</span>
            <span class="c1"># Defaults to alpha-numeric</span>
            <span class="c1"># Generates password string with:</span>
            <span class="c1"># lowercase,uppercase, numbers and special chars</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass type =&gt; default (&#39;alpha-numeric&#39;)&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pass_length</span><span class="p">:</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lowercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">uppercase</span><span class="p">))</span>
                <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stackcreate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test_list</span><span class="p">,</span> <span class="n">sprefix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function creates CloudFormation stack for the given tests.</span>

<span class="sd">        :param taskcat_cfg: TaskCat config as yaml object</span>
<span class="sd">        :param test_list: List of tests</span>
<span class="sd">        :param sprefix: Special prefix as string. Purpose of this param is to use it for tagging</span>
<span class="sd">            the stack.</span>

<span class="sd">        :return: List of TestData objects</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">testdata_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_capabilities</span><span class="p">(</span><span class="s1">&#39;CAPABILITY_IAM&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">:</span>
            <span class="n">testdata</span> <span class="o">=</span> <span class="n">TestData</span><span class="p">()</span>
            <span class="n">testdata</span><span class="o">.</span><span class="n">set_test_name</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}{1}|PREPARING TO LAUNCH =&gt; {2}{3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
            <span class="n">sname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
            <span class="n">stackname</span> <span class="o">=</span> <span class="n">sname</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">sprefix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">test</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">jobid</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">define_tests</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_region</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Preparing to launch in region [</span><span class="si">%s</span><span class="s2">] &quot;</span> <span class="o">%</span> <span class="n">region</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
                    <span class="n">s_parmsdata</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">s_parms</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s_parmsdata</span><span class="p">)</span>
                    <span class="c1"># gentype = None</span>

                    <span class="c1"># Auto-generated stack inputs</span>

                    <span class="c1"># (Passwords)</span>
                    <span class="c1"># Value that matches the following pattern will be replaced</span>
                    <span class="c1"># - Parameters must start with $[</span>
                    <span class="c1"># - Parameters must end with ]</span>
                    <span class="c1"># - genpass in invoked when _genpass_X is found</span>
                    <span class="c1"># - X is lengeth of the string</span>
                    <span class="c1"># Example: $[taskcat_genpass_8]</span>
                    <span class="c1"># Optionally - you can specify the type of password by adding</span>
                    <span class="c1"># - A aplha-numeric passwords</span>
                    <span class="c1"># - S passwords with special characters</span>
                    <span class="c1"># Example: $[taskcat_genpass_8A]</span>
                    <span class="c1"># Generates: tI8zN3iX8</span>
                    <span class="c1"># or</span>
                    <span class="c1"># Example: $[taskcat_genpass_8S]</span>
                    <span class="c1"># Generates: mA5@cB5!</span>

                    <span class="c1"># (Availablity Zones)</span>
                    <span class="c1"># Value that matches the following pattern will be replaced</span>
                    <span class="c1"># - Parameters must start with $[</span>
                    <span class="c1"># - Parameters must end with ]</span>
                    <span class="c1"># - genaz in invoked when _genaz_X is found</span>
                    <span class="c1"># - A number of AZ&#39;s will be selected from the region</span>
                    <span class="c1">#   the stack is attempting to launch</span>
                    <span class="c1"># Example: $[taskcat_genaz_2] (if the region is us-east-2)</span>
                    <span class="c1"># Generates: us-east-1a, us-east-2b</span>

                    <span class="k">for</span> <span class="n">parmdict</span> <span class="ow">in</span> <span class="n">s_parms</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">parmdict</span><span class="p">:</span>

                            <span class="n">param_value</span> <span class="o">=</span> <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span>
                            <span class="c1"># Determines the size of the password to generate</span>
                            <span class="n">count_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?!\w+_genpass_)\d{1,2}&#39;</span><span class="p">)</span>

                            <span class="c1"># Determines the type of password to generate</span>
                            <span class="n">gentype_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                                <span class="s1">&#39;(?!\w+_genpass_\d{1,2}])([AS])&#39;</span><span class="p">)</span>

                            <span class="c1"># Determines if _genpass has been requested</span>
                            <span class="n">genpass_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                                <span class="s1">&#39;\$\[\w+_genpass?(\w)_\d{1,2}\w?]$&#39;</span><span class="p">)</span>

                            <span class="c1"># Determines if _genaz has been requested</span>
                            <span class="n">genaz_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\$\[\w+_genaz_\d]&#39;</span><span class="p">)</span>

                            <span class="c1"># Determines if s3 replacement was requested</span>
                            <span class="n">gets3replace</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\$\[\w+_url_.+]$&#39;</span><span class="p">)</span>
                            <span class="n">geturl_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=._url_)(.+)(?=]$)&#39;</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">gets3replace</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param_value</span><span class="p">):</span>
                                <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">geturl_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">)</span>
                                <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3contents</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Raw content of url {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
                                <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>

                            <span class="c1"># Autogenerated value to password input in runtime</span>
                            <span class="k">if</span> <span class="n">genpass_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param_value</span><span class="p">):</span>
                                <span class="n">passlen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">count_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">))</span>
                                <span class="n">gentype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span>
                                    <span class="n">gentype_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">)</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">gentype</span><span class="p">:</span>
                                    <span class="c1"># Set default password type</span>
                                    <span class="c1"># A vaule of D will generate a simple alpha</span>
                                    <span class="c1"># aumeric password</span>
                                    <span class="n">gentype</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>

                                <span class="k">if</span> <span class="n">passlen</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}AutoGen values for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">param_value</span><span class="p">))</span>
                                    <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genpassword</span><span class="p">(</span>
                                        <span class="n">passlen</span><span class="p">,</span> <span class="n">gentype</span><span class="p">)</span>
                                    <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>

                            <span class="k">if</span> <span class="n">genaz_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param_value</span><span class="p">):</span>
                                <span class="n">numazs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">count_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">))</span>
                                <span class="k">if</span> <span class="n">numazs</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Selecting availability zones&quot;</span><span class="p">)</span>
                                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Requested </span><span class="si">%s</span><span class="s2"> az&#39;s&quot;</span> <span class="o">%</span> <span class="n">numazs</span><span class="p">)</span>

                                    <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available_azs</span><span class="p">(</span>
                                        <span class="n">region</span><span class="p">,</span>
                                        <span class="n">numazs</span><span class="p">)</span>
                                    <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;$[taskcat_genaz_(!)]&quot;</span><span class="p">)</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Number of az&#39;s not specified!&quot;</span><span class="p">)</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot; - (Defaulting to 1 az)&quot;</span><span class="p">)</span>
                                    <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available_azs</span><span class="p">(</span>
                                        <span class="n">region</span><span class="p">,</span>
                                        <span class="mi">1</span><span class="p">)</span>
                                    <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Creating Boto Connection region=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">region</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;StackName=&quot;</span> <span class="o">+</span> <span class="n">stackname</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;DisableRollback=True&quot;</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;TemplateURL=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">())</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Capabilities=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_capabilities</span><span class="p">())</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Parameters:&quot;</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">s_parms</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>

                    <span class="n">stackdata</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">create_stack</span><span class="p">(</span>
                        <span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">,</span>
                        <span class="n">DisableRollback</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">TemplateURL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">(),</span>
                        <span class="n">Parameters</span><span class="o">=</span><span class="n">s_parms</span><span class="p">,</span>
                        <span class="n">Capabilities</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_capabilities</span><span class="p">())</span>

                    <span class="n">testdata</span><span class="o">.</span><span class="n">add_test_stack</span><span class="p">(</span><span class="n">stackdata</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Cannot launch </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">())</span>

            <span class="n">testdata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testdata</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |{}LAUNCHING STACKS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} {}{} {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">I</span><span class="p">,</span>
                    <span class="n">header</span><span class="p">,</span>
                    <span class="n">test</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">(),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:stack&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">rst_color</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">testdata_list</span>

    <span class="k">def</span> <span class="nf">validate_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function validates the given JSON.</span>

<span class="sd">        :param jsonin: Json object to be validated</span>

<span class="sd">        :return: TRUE if given Json is valid, FALSE otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parms</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jsonin</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parms</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">validate_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function validates the parameters file of the CloudFormation template.</span>

<span class="sd">        :param taskcat_cfg: TaskCat config yaml object</span>
<span class="sd">        :param test_list: List of tests</span>

<span class="sd">        :return: TRUE if the parameters file is valid, else FALSE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">define_tests</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; |Validate JSON input in test[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;parameter_path = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span>

            <span class="n">inputparms</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span><span class="o">.</span><span class="n">text</span>
            <span class="n">jsonstatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_json</span><span class="p">(</span><span class="n">inputparms</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;jsonstatus = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">jsonstatus</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">jsonstatus</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="s2">&quot;Validated [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;parameter_file = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">())</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Cannot validate </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">regxfind</span><span class="p">(</span><span class="n">re_object</span><span class="p">,</span> <span class="n">data_line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the matching string.</span>

<span class="sd">        :param re_object: Regex object</span>
<span class="sd">        :param data_line: String to be searched</span>

<span class="sd">        :return: Matching String if found, otherwise return &#39;Not-found&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sg</span> <span class="o">=</span> <span class="n">re_object</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">data_line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sg</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Not-found&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse_stack_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary object containing the region and stack name.</span>

<span class="sd">        :param stack_name: Full stack name arn</span>
<span class="sd">        :return: Dictionary object containing the region and stack name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stack_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">region_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=:)(.\w-.+(\w*)-\d)(?=:)&#39;</span><span class="p">)</span>
        <span class="n">stack_name_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=:stack/)(tCaT.*.)(?=/)&#39;</span><span class="p">)</span>
        <span class="n">stack_info</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">region_re</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">)</span>
        <span class="n">stack_info</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">stack_name_re</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stack_info</span>

    <span class="k">def</span> <span class="nf">stackcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the stack id, this function returns the status of the stack as</span>
<span class="sd">        a list with stack name, region, and status as list items, in the respective</span>
<span class="sd">        order.</span>

<span class="sd">        :param stack_id: CloudFormation stack id</span>

<span class="sd">        :return: List containing the stack name, region and stack status in the</span>
<span class="sd">            respective order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="n">stack_id</span><span class="p">)</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
        <span class="n">stack_name</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]</span>
        <span class="n">test_info</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="c1"># noinspection PyBroadException</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_query</span> <span class="o">=</span> <span class="p">(</span><span class="n">cfn</span><span class="o">.</span><span class="n">describe_stacks</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stack_name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">test_query</span><span class="p">[</span><span class="s1">&#39;Stacks&#39;</span><span class="p">]:</span>
                <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack_name</span><span class="p">)</span>
                <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
                <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackStatus&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;StackStatus&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;CREATE_IN_PROGRESS&#39;</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackStatus&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;DELETE_IN_PROGRESS&#39;</span><span class="p">:</span>
                    <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack_name</span><span class="p">)</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;STACK_DELETED&quot;</span><span class="p">)</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">test_info</span>

    <span class="k">def</span> <span class="nf">get_stackstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list of TestData objects, this function checks the stack status</span>
<span class="sd">        of each CloudFormation stack and updates the corresponding TestData object</span>
<span class="sd">        with the status.</span>

<span class="sd">        :param testdata_list: List of TestData object</span>
<span class="sd">        :param speed: Interval (in seconds) in which the status has to be checked in loop</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">active_tests</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">active_tests</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_active_tests</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;{}{} {} [{}]{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">header</span><span class="p">,</span>
                <span class="s1">&#39;AWS REGION&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
                <span class="s1">&#39;CLOUDFORMATION STACK STATUS&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
                <span class="s1">&#39;CLOUDFORMATION STACK NAME&#39;</span><span class="p">,</span>
                <span class="n">rst_color</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                    <span class="n">stackquery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackcheck</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                    <span class="n">current_active_tests</span> <span class="o">=</span> <span class="n">stackquery</span><span class="p">[</span>
                                               <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">current_active_tests</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;{3}{0} {1} [{2}]{4}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">stackquery</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
                        <span class="n">stackquery</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
                        <span class="n">stackquery</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">hightlight</span><span class="p">,</span>
                        <span class="n">rst_color</span><span class="p">))</span>
                    <span class="n">stack</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stackquery</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">active_tests</span> <span class="o">=</span> <span class="n">current_active_tests</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function deletes the CloudFormation stacks of the given tests.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>
<span class="sd">        :param speed: Interval (in seconds) in which the status has to be checked</span>
<span class="sd">            while deleting the stacks.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">docleanup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_docleanup</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;clean-up = </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">docleanup</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">docleanup</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |CLEANUP STACKS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stackdelete</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_stackstatus</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deep_cleanup</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;[Retaining Stacks (Cleanup is set to {0}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docleanup</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">deep_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function deletes the AWS resources which were not deleted</span>
<span class="sd">        by deleting CloudFormation stacks.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="n">failed_stack_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;DELETE_FAILED&#39;</span><span class="p">:</span>
                    <span class="n">failed_stack_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_stack_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;All stacks deleted successfully. Deep clean-up not required.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Few stacks failed to delete. Collecting resources for deep clean-up.&quot;</span><span class="p">)</span>
            <span class="c1"># get test region from the stack id</span>
            <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">failed_stack_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">Sweeper</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
            <span class="n">failed_stacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_resources</span><span class="p">(</span><span class="n">failed_stack_ids</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
            <span class="c1"># print all resources which failed to delete</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Resources which failed to delete:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">failed_stack</span> <span class="ow">in</span> <span class="n">failed_stacks</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Stack Id: &quot;</span> <span class="o">+</span> <span class="n">failed_stack</span><span class="p">[</span><span class="s1">&#39;stackId&#39;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">failed_stack</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;{0} = {1}, {2} = {3}, {4} = {5}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">LogicalId&#39;</span><span class="p">,</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logicalId&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">PhysicalId&#39;</span><span class="p">,</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;physicalId&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">Type&#39;</span><span class="p">,</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resourceType&#39;</span><span class="p">)</span>
                        <span class="p">))</span>
                <span class="n">s</span><span class="o">.</span><span class="n">delete_all</span><span class="p">(</span><span class="n">failed_stacks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stackdelete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function deletes the CloudFormation stacks of the given tests.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
                <span class="n">stack_name</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]</span>
                <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
                <span class="n">cfn</span><span class="o">.</span><span class="n">delete_stack</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stack_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">if_stackexists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function checks if a stack exist with the given stack name.</span>
<span class="sd">        Returns &quot;yes&quot; if exist, otherwise &quot;no&quot;.</span>

<span class="sd">        :param stackname: Stack name</span>
<span class="sd">        :param region: AWS region</span>

<span class="sd">        :return: &quot;yes&quot; if stack exist, otherwise &quot;no&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cfn</span><span class="o">.</span><span class="n">describe_stacks</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
            <span class="n">exists</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">exists</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Successfully Deleted[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">stackname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exists</span>

    <span class="k">def</span> <span class="nf">define_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yamlc</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function reads the given test config yaml object and defines</span>
<span class="sd">        the tests as per the given config object.</span>

<span class="sd">        :param yamlc: TaskCat config yaml object</span>
<span class="sd">        :param test: Test scenarios</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tdefs</span> <span class="ow">in</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># print(&quot;[DEBUG] tdefs = %s&quot; % tdefs)</span>
            <span class="k">if</span> <span class="n">tdefs</span> <span class="o">==</span> <span class="n">test</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;template_file&#39;</span><span class="p">]</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;parameter_input&#39;</span><span class="p">]</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;qsname&#39;</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">()</span>

                <span class="c1"># Checks if cleanup flag is set</span>
                <span class="c1"># If cleanup is set to &#39;false&#39; stack will not be deleted after</span>
                <span class="c1"># launch attempt</span>
                <span class="k">if</span> <span class="s1">&#39;cleanup&#39;</span> <span class="ow">in</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cleanupstack</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;cleanup&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">cleanupstack</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;cleanup set to ymal value&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">set_docleanup</span><span class="p">(</span><span class="n">cleanupstack</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Cleanup value set to (false)&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_docleanup</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># By default do cleanup unless self.run_cleanup</span>
                    <span class="c1"># was overwridden (set to False) by -n flag</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;cleanup set by cli flag {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_docleanup</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;No cleanup value set&quot;</span><span class="p">)</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot; - (Defaulting to cleanup)&quot;</span><span class="p">)</span>

                <span class="c1"># Load test setting</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_s3bucket</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_project</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_template_file</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_file</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_template_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">()))</span>

                <span class="c1"># Check to make sure template filenames are correct</span>
                <span class="n">template_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">template_path</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Could not locate {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Check to make sure filename is correct?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">()))</span>
                    <span class="n">quit</span><span class="p">()</span>

                <span class="c1"># Check to make sure parameter filenames are correct</span>
                <span class="n">parameter_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parameter_path</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Could not locate {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">()))</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Check to make sure filename is correct?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">()))</span>
                    <span class="n">quit</span><span class="p">()</span>

                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;|Acquiring tests assets for .......[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|S3 Bucket  =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">())</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Project    =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">())</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Template   =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">())</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Parameter  =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span>
                <span class="k">if</span> <span class="s1">&#39;regions&#39;</span> <span class="ow">in</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">r</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_test_region</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Defined Regions:&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">list_o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_region</span><span class="p">():</span>
                                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="s2"> - [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">list_o</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">global_regions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_region</span><span class="p">(</span><span class="n">yamlc</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_test_region</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">global_regions</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Global Regions:&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">list_o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_region</span><span class="p">():</span>
                            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="s2"> - [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">list_o</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="s2">&quot;(Completed) acquisition of [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Set AWS Credentials</span>
    <span class="k">def</span> <span class="nf">aws_api_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function reads the AWS credentials from various sources to ensure</span>
<span class="sd">        that the client has right credentials defined to successfully run</span>
<span class="sd">        TaskCat against an AWS account.</span>

<span class="sd">        :param args: Command line arguments for AWS credentials. It could be</span>
<span class="sd">            either profile name, access key and secret key or none.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">boto_profile</span><span class="p">:</span>
            <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span><span class="n">profile_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">boto_profile</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sts_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
                <span class="n">account</span> <span class="o">=</span> <span class="n">sts_client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :AWS AccountNumber: </span><span class="se">\t</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Authenticated via: </span><span class="se">\t</span><span class="s2"> [boto-profile] &quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Credential Error - Please check you profile!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span><span class="p">:</span>
            <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span>
                <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span><span class="p">,</span>
                <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sts_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
                <span class="n">account</span> <span class="o">=</span> <span class="n">sts_client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :AWS AccountNumber: </span><span class="se">\t</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Authenticated via: </span><span class="se">\t</span><span class="s2"> [role] &quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Credential Error - Please check you keys!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span>
                <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span><span class="p">,</span>
                <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sts_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
                <span class="n">account</span> <span class="o">=</span> <span class="n">sts_client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :AWS AccountNumber: </span><span class="se">\t</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Authenticated via: </span><span class="se">\t</span><span class="s2"> [role] &quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Credential Error - Cannot assume role!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function validates the given yaml file.</span>

<span class="sd">        :param yaml_file: Yaml file name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">run_tests</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">required_global_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;qsname&#39;</span><span class="p">,</span>
            <span class="s1">&#39;owner&#39;</span><span class="p">,</span>
            <span class="s1">&#39;reporting&#39;</span><span class="p">,</span>
            <span class="s1">&#39;regions&#39;</span>
        <span class="p">]</span>

        <span class="n">required_test_parameters</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;template_file&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parameter_input&#39;</span>
        <span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Reading Config form: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">))</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">checkyaml</span><span class="p">:</span>
                    <span class="n">cfg_yml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">checkyaml</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_global_keys</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;global:</span><span class="si">%s</span><span class="s2"> missing from &quot;</span> <span class="o">%</span> <span class="n">key</span> <span class="o">+</span> <span class="n">yaml_file</span><span class="p">)</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">run_tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">defined</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; |Queing test =&gt; </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">defined</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">parms</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">defined</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_test_parameters</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">defined</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="k">pass</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No key </span><span class="si">%s</span><span class="s2"> in test&quot;</span> <span class="o">%</span> <span class="n">key</span> <span class="o">+</span> <span class="n">defined</span><span class="p">)</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;While inspecting: &quot;</span> <span class="o">+</span> <span class="n">parms</span><span class="p">)</span>
                                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Cannot open [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">yaml_file</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;config.yml [</span><span class="si">%s</span><span class="s2">] is not formatted well!!&quot;</span> <span class="o">%</span> <span class="n">yaml_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">run_tests</span>

    <span class="k">def</span> <span class="nf">genreport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">dashboard_filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function generates the test report.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>
<span class="sd">        :param dashboard_filename: Report file name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">yattag</span><span class="o">.</span><span class="n">Doc</span><span class="p">()</span>

        <span class="c1"># Type of cfnlog return cfn log file</span>
        <span class="c1"># Type of resource_log return resource log file</span>
        <span class="k">def</span> <span class="nf">getofile</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">):</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
            <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s1">&#39;cfnlog&#39;</span><span class="p">:</span>
                <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;{}-{}-{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack_name</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="s1">&#39;cfnlogs&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s1">&#39;resource_log&#39;</span><span class="p">:</span>
                <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;{}-{}-{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack_name</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_teststate</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
            <span class="c1"># Add try catch and return MANUALLY_DELETED</span>
            <span class="c1"># Add css test-orange</span>
            <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
            <span class="n">test_query</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">describe_stacks</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
            <span class="n">rstatus</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">status_css</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">test_query</span><span class="p">[</span><span class="s1">&#39;Stacks&#39;</span><span class="p">]:</span>
                <span class="n">rstatus</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackStatus&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rstatus</span> <span class="o">==</span> <span class="s1">&#39;CREATE_COMPLETE&#39;</span><span class="p">:</span>
                    <span class="n">status_css</span> <span class="o">=</span> <span class="s1">&#39;class=test-green&#39;</span>
                <span class="k">elif</span> <span class="n">rstatus</span> <span class="o">==</span> <span class="s1">&#39;CREATE_FAILED&#39;</span><span class="p">:</span>
                    <span class="n">status_css</span> <span class="o">=</span> <span class="s1">&#39;class=test-red&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">status_css</span> <span class="o">=</span> <span class="s1">&#39;class=test-red&#39;</span>
            <span class="k">return</span> <span class="n">rstatus</span><span class="p">,</span> <span class="n">status_css</span>

        <span class="n">tag</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">tag</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">text</span>
        <span class="n">logo</span> <span class="o">=</span> <span class="s1">&#39;taskcat&#39;</span>
        <span class="n">repo_link</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/aws-quickstart/taskcat&#39;</span>
        <span class="n">output_css</span> <span class="o">=</span> <span class="s1">&#39;https://taskcat.s3.amazonaws.com/assets/css/taskcat.css&#39;</span>
        <span class="n">doc_link</span> <span class="o">=</span> <span class="s1">&#39;http://taskcat.io&#39;</span>

        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">):</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span>
                    <span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;width=device-width&quot;</span><span class="p">)</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="s1">&#39;stylesheet&#39;</span><span class="p">,</span>
                         <span class="n">href</span><span class="o">=</span><span class="n">output_css</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">):</span>
                    <span class="n">text</span><span class="p">(</span><span class="s1">&#39;TaskCat Report&#39;</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">):</span>
                <span class="n">tested_on</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%A - %b,</span><span class="si">%d</span><span class="s1">,%Y @ %H:%M:%S&#39;</span><span class="p">)</span>

                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;class=header-table-fill&#39;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">):</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span> <span class="s1">&#39;colspan=2&#39;</span><span class="p">):</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">):</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">repo_link</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="s1">&#39;GitHub Repo: &#39;</span><span class="p">)</span>
                                        <span class="n">text</span><span class="p">(</span><span class="n">repo_link</span><span class="p">)</span>
                                        <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;br&#39;</span><span class="p">)</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">doc_link</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Documentation: &#39;</span><span class="p">)</span>
                                        <span class="n">text</span><span class="p">(</span><span class="n">doc_link</span><span class="p">)</span>
                                        <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;br&#39;</span><span class="p">)</span>
                                    <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Tested on: &#39;</span><span class="p">)</span>
                                    <span class="n">text</span><span class="p">(</span><span class="n">tested_on</span><span class="p">)</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;class=taskcat-logo&#39;</span><span class="p">):</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;class=table-fill&#39;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;thread&#39;</span><span class="p">):</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-center&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=25%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Test Name&#39;</span><span class="p">)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=10%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Tested Region&#39;</span><span class="p">)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=30%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Stack Name&#39;</span><span class="p">)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=20%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Tested Results&#39;</span><span class="p">)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;width=15%&#39;</span><span class="p">):</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Test Logs&#39;</span><span class="p">)</span>

                            <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">,</span> <span class="s1">&#39;class= test-footer&#39;</span><span class="p">):</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;colspan=5&#39;</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                                <span class="n">testname</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">()</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;(Generating Reports)&quot;</span><span class="p">)</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot; - Processing {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testname</span><span class="p">))</span>
                                <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                                    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                                    <span class="n">status</span><span class="p">,</span> <span class="n">css</span> <span class="o">=</span> <span class="n">get_teststate</span><span class="p">(</span>
                                        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">],</span>
                                        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>

                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;class=test-info&#39;</span><span class="p">):</span>
                                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">):</span>
                                                <span class="n">text</span><span class="p">(</span><span class="n">testname</span><span class="p">)</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">):</span>
                                            <span class="n">text</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">):</span>
                                            <span class="n">text</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">])</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="n">css</span><span class="p">):</span>
                                            <span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">):</span>
                                            <span class="n">clog</span> <span class="o">=</span> <span class="n">getofile</span><span class="p">(</span>
                                                <span class="n">state</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">],</span>
                                                <span class="n">state</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">],</span>
                                                <span class="s1">&#39;cfnlog&#39;</span><span class="p">)</span>
                                            <span class="c1"># rlog = getofile(</span>
                                            <span class="c1">#    state[&#39;region&#39;],</span>
                                            <span class="c1">#    state[&#39;stack_name&#39;],</span>
                                            <span class="c1">#    &#39;resource_log&#39;)</span>
                                            <span class="c1">#</span>
                                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">clog</span><span class="p">):</span>
                                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;View Logs &#39;</span><span class="p">)</span>
                                                <span class="c1"># with tag(&#39;a&#39;, href=rlog):</span>
                                                <span class="c1">#    text(&#39;Resource Logs &#39;)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">,</span> <span class="s1">&#39;class= test-footer&#39;</span><span class="p">):</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;colspan=5&#39;</span><span class="p">):</span>
                                    <span class="n">vtag</span> <span class="o">=</span> <span class="s1">&#39;Generated by {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;taskcat&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
                                    <span class="n">text</span><span class="p">(</span><span class="n">vtag</span><span class="p">)</span>

                        <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">htmloutput</span> <span class="o">=</span> <span class="n">yattag</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
                                   <span class="n">indentation</span><span class="o">=</span><span class="s1">&#39;    &#39;</span><span class="p">,</span>
                                   <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                   <span class="n">indent_text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dashboard_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">htmloutput</span><span class="p">)</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">htmloutput</span>

    <span class="k">def</span> <span class="nf">collect_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function collects the AWS resources information created by the</span>
<span class="sd">        CloudFormation stack for generating the report.</span>

<span class="sd">        :param testdata_list: List of TestData object</span>
<span class="sd">        :param logpath: Log file path</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;(Collecting Resources)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="n">stackinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                <span class="c1"># Get stack resources</span>
                <span class="n">resource</span><span class="p">[</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
                <span class="n">test_logpath</span> <span class="o">=</span> <span class="s1">&#39;{}/{}-{}-{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">logpath</span><span class="p">,</span>
                    <span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">],</span>
                    <span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;resources&#39;</span><span class="p">,</span>
                    <span class="n">extension</span><span class="p">)</span>

                <span class="c1"># Write resource logs</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">test_logpath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                        <span class="n">resource</span><span class="p">,</span>
                        <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                        <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))))</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_cfnlogs</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns the event logs of the given stack in a specific format.</span>
<span class="sd">        :param stackname: Name of the stack</span>
<span class="sd">        :param region: Region stack belongs to</span>
<span class="sd">        :return: Event logs of the stack</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Collecting logs for &quot;</span> <span class="o">+</span> <span class="n">stackname</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Collect stack_events</span>
        <span class="n">stack_events</span> <span class="o">=</span> <span class="n">get_cfn_stack_events</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="c1"># Uncomment line for debug</span>
        <span class="c1"># pprint.pprint (stack_events)</span>
        <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">stack_events</span><span class="p">:</span>
            <span class="n">event_details</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TimeStamp&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;ResourceStatus&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ResourceStatus&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;ResourceType&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">]}</span>
            <span class="k">if</span> <span class="s1">&#39;ResourceStatusReason&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
                <span class="n">event_details</span><span class="p">[</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">event_details</span><span class="p">[</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_details</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">events</span>

    <span class="k">def</span> <span class="nf">createcfnlogs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function creates the CloudFormation log files.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>
<span class="sd">        :param logpath: Log file path</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;(Collecting CloudFormation Logs)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="n">stackinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                <span class="n">stackname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">])</span>
                <span class="n">region</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
                <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
                <span class="n">test_logpath</span> <span class="o">=</span> <span class="s1">&#39;{}/{}-{}-{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">logpath</span><span class="p">,</span>
                    <span class="n">stackname</span><span class="p">,</span>
                    <span class="n">region</span><span class="p">,</span>
                    <span class="s1">&#39;cfnlogs&#39;</span><span class="p">,</span>
                    <span class="n">extension</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_logs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]),</span> <span class="n">test_logpath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_id</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes the event logs of the given stack and all the child stacks to a given file.</span>
<span class="sd">        :param stack_id: Stack Id</span>
<span class="sd">        :param logpath: Log file path</span>
<span class="sd">        :return: </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stackinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack_id</span><span class="p">))</span>
        <span class="n">stackname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">])</span>
        <span class="n">region</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>

        <span class="c1"># Get stack resources</span>
        <span class="n">cfnlogs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cfnlogs</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cfnlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ResourceStatus&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;CREATE_COMPLETE&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ResourceStatusReason&#39;</span> <span class="ow">in</span> <span class="n">cfnlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="n">cfnlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;Stack launch was successful&quot;</span>

        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |StackName: &quot;</span> <span class="o">+</span> <span class="n">stackname</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |Region: &quot;</span> <span class="o">+</span> <span class="n">region</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |Logging to: &quot;</span> <span class="o">+</span> <span class="n">logpath</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |Tested on: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, </span><span class="si">%d</span><span class="s2">. %B %Y %I:%M%p&quot;</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;------------------------------------------------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;ResourceStatusReason: &quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reason</span><span class="p">),</span> <span class="mi">85</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;==========================================================================================&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logpath</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log_output</span><span class="p">:</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Region: &quot;</span> <span class="o">+</span> <span class="n">region</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;StackName: &quot;</span> <span class="o">+</span> <span class="n">stackname</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ResourceStatusReason:  </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reason</span><span class="p">),</span> <span class="mi">85</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Events:  </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">cfnlogs</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">))</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Tested on: &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, </span><span class="si">%d</span><span class="s2">. %B %Y %I:%M%p&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;-----------------------------------------------------------------------------</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">log_output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Collect resources of the stack and get event logs for any child stacks</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">include_stacks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resource</span><span class="p">[</span><span class="s1">&#39;resourceType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AWS::CloudFormation::Stack&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_logs</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;physicalId&#39;</span><span class="p">],</span> <span class="n">logpath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">createreport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function creates the test report.</span>

<span class="sd">        :param testdata_list: List of TestData objects</span>
<span class="sd">        :param filename: Report file name</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">o_directory</span> <span class="o">=</span> <span class="s1">&#39;taskcat_outputs&#39;</span>

        <span class="c1"># noinspection PyBroadException</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">o_directory</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">o_directory</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |GENERATING REPORTS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Creating report in [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">o_directory</span><span class="p">)</span>
        <span class="n">dashboard_filename</span> <span class="o">=</span> <span class="n">o_directory</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>

        <span class="c1"># Collect recursive logs</span>
        <span class="c1"># file path is already setup by getofile function in genreports</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createcfnlogs</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">,</span> <span class="n">o_directory</span><span class="p">)</span>

        <span class="c1"># Generate html test dashboard</span>
        <span class="c1"># Uses logpath + region to create View Logs link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genreport</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">,</span> <span class="n">dashboard_filename</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Multi-Region CloudFormation Deployment Tool)</span>
<span class="s2">            </span>
<span class="s2">    [Auto-generated stack inputs] </span>
<span class="s2">    Auto-select available az</span><span class="se">\&#39;</span><span class="s2">s at runtime based test region defined $[_genazX] $[_genaz&lt;number of az</span><span class="se">\&#39;</span><span class="s2">s&gt;] </span>
<span class="s2">    Generate password during runtime $[_genpass_XX]  $[_genpass_&lt;length&gt;_&lt;type&gt;]</span>
<span class="s2">        - Parameters value in json input file must start with </span><span class="se">\&#39;</span><span class="s2">$[</span><span class="se">\&#39;</span><span class="s2"> end with </span><span class="se">\&#39;</span><span class="s2">]</span><span class="se">\&#39;</span><span class="s2"></span>
<span class="s2">    </span>
<span class="s2">    Example:[ {</span>
<span class="s2">        &quot;ParameterKey&quot;: &quot;AvailabilityZones&quot;,</span>
<span class="s2">        &quot;ParameterValue&quot;: &quot;$[taskcat_genaz_2]&quot;</span>
<span class="s2">    } ]</span>
<span class="s2">    Generates: us-east-1a, us-east-2b</span>
<span class="s2">    </span>
<span class="s2">    Example:[ {</span>
<span class="s2">        &quot;ParameterKey&quot;: &quot;AppPassword&quot;,</span>
<span class="s2">        &quot;ParameterValue&quot;: &quot;$[taskcat_genpass_8]&quot;</span>
<span class="s2">    } ]</span>
<span class="s2">    </span>
<span class="s2">    Generates: tI8zN3iX8 </span>
<span class="s2">    Optionally: $[taskcat_genpass_8S]</span>
<span class="s2">    Generates: mA5@cB5!</span>
<span class="s2">    </span>
<span class="s2">    For more info see: http://taskcat.io</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">prog</span><span class="o">=</span><span class="s1">&#39;taskcat&#39;</span><span class="p">,</span>
            <span class="n">prefix_chars</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
            <span class="n">formatter_class</span><span class="o">=</span><span class="n">RawTextHelpFormatter</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--config_yml&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;(Required!) [config.yml] pass &#39;-ey&#39; for example&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-P&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--boto_profile&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Authenticate using boto profile&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-A&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--aws_access_key&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;AWS Access Key&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-S&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--aws_secret_key&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;AWS Secrect Key&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-ey&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--example_yaml&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print out example yaml&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-n&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--no_cleanup&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Sets cleanup to false (Does not teardown stacks)&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-v&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--verbose&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Enables verbosity&quot;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">())</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">example_yaml</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;#An example: config.yml file to be used with </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="vm">__name__</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">yaml_cfg</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># Overrides Defaults for cleanup but does not overwrite config.yml</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">no_cleanup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">boto_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot use boto profile -P (--boto_profile)&quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;with --aws_access_key or --aws_secret_key&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">())</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">welcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog_name</span><span class="o">=</span><span class="s1">&#39;taskcat.io&#39;</span><span class="p">):</span>
        <span class="n">banner</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="o">.</span><span class="n">Figlet</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="n">banner</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">banner</span><span class="o">.</span><span class="n">renderText</span><span class="p">(</span><span class="n">prog_name</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;version </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">version</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#taskcat.TaskCat">TaskCat</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>

  <div class="item">
    <div class="name def" id="taskcat.TaskCat.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, nametag=&#39;[taskcat]&#39;)</p>
    </div>




    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.__init__', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nametag</span><span class="o">=</span><span class="s1">&#39;[taskcat]&#39;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">=</span> <span class="s1">&#39;{1}{0}{2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nametag</span><span class="p">,</span> <span class="n">name_color</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="s1">&#39;config.yml&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">defult_region</span> <span class="o">=</span> <span class="s2">&quot;us-east-1&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_template_file</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_file</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_path</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_termsize</span> <span class="o">=</span> <span class="mi">110</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_banner</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_report</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_global</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.aws_api_init">
    <p>def <span class="ident">aws_api_init</span>(</p><p>self, args)</p>
    </div>




    <div class="desc"><p>This function reads the AWS credentials from various sources to ensure
that the client has right credentials defined to successfully run
TaskCat against an AWS account.</p>
<p>:param args: Command line arguments for AWS credentials. It could be
    either profile name, access key and secret key or none.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.aws_api_init', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.aws_api_init" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">aws_api_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function reads the AWS credentials from various sources to ensure</span>
<span class="sd">    that the client has right credentials defined to successfully run</span>
<span class="sd">    TaskCat against an AWS account.</span>
<span class="sd">    :param args: Command line arguments for AWS credentials. It could be</span>
<span class="sd">        either profile name, access key and secret key or none.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">boto_profile</span><span class="p">:</span>
        <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span><span class="n">profile_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">boto_profile</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sts_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
            <span class="n">account</span> <span class="o">=</span> <span class="n">sts_client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :AWS AccountNumber: </span><span class="se">\t</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Authenticated via: </span><span class="se">\t</span><span class="s2"> [boto-profile] &quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Credential Error - Please check you profile!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span><span class="p">:</span>
        <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span>
            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span><span class="p">,</span>
            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sts_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
            <span class="n">account</span> <span class="o">=</span> <span class="n">sts_client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :AWS AccountNumber: </span><span class="se">\t</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Authenticated via: </span><span class="se">\t</span><span class="s2"> [role] &quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Credential Error - Please check you keys!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">boto3</span><span class="o">.</span><span class="n">setup_default_session</span><span class="p">(</span>
            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_access_key</span><span class="p">,</span>
            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">aws_secret_key</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sts_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>
            <span class="n">account</span> <span class="o">=</span> <span class="n">sts_client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :AWS AccountNumber: </span><span class="se">\t</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Authenticated via: </span><span class="se">\t</span><span class="s2"> [role] &quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Credential Error - Cannot assume role!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.cleanup">
    <p>def <span class="ident">cleanup</span>(</p><p>self, testdata_list, speed)</p>
    </div>




    <div class="desc"><p>This function deletes the CloudFormation stacks of the given tests.</p>
<p>:param testdata_list: List of TestData objects
:param speed: Interval (in seconds) in which the status has to be checked
    while deleting the stacks.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.cleanup', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.cleanup" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function deletes the CloudFormation stacks of the given tests.</span>
<span class="sd">    :param testdata_list: List of TestData objects</span>
<span class="sd">    :param speed: Interval (in seconds) in which the status has to be checked</span>
<span class="sd">        while deleting the stacks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">docleanup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_docleanup</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;clean-up = </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">docleanup</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">docleanup</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |CLEANUP STACKS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stackdelete</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_stackstatus</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deep_cleanup</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;[Retaining Stacks (Cleanup is set to {0}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">docleanup</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.collect_resources">
    <p>def <span class="ident">collect_resources</span>(</p><p>self, testdata_list, logpath)</p>
    </div>




    <div class="desc"><p>This function collects the AWS resources information created by the
CloudFormation stack for generating the report.</p>
<p>:param testdata_list: List of TestData object
:param logpath: Log file path</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.collect_resources', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.collect_resources" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">collect_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function collects the AWS resources information created by the</span>
<span class="sd">    CloudFormation stack for generating the report.</span>
<span class="sd">    :param testdata_list: List of TestData object</span>
<span class="sd">    :param logpath: Log file path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;(Collecting Resources)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
            <span class="n">stackinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
            <span class="c1"># Get stack resources</span>
            <span class="n">resource</span><span class="p">[</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
            <span class="n">test_logpath</span> <span class="o">=</span> <span class="s1">&#39;{}/{}-{}-{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">logpath</span><span class="p">,</span>
                <span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">],</span>
                <span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">],</span>
                <span class="s1">&#39;resources&#39;</span><span class="p">,</span>
                <span class="n">extension</span><span class="p">)</span>
            <span class="c1"># Write resource logs</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">test_logpath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                    <span class="n">resource</span><span class="p">,</span>
                    <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))))</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.createcfnlogs">
    <p>def <span class="ident">createcfnlogs</span>(</p><p>self, testdata_list, logpath)</p>
    </div>




    <div class="desc"><p>This function creates the CloudFormation log files.</p>
<p>:param testdata_list: List of TestData objects
:param logpath: Log file path
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.createcfnlogs', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.createcfnlogs" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createcfnlogs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function creates the CloudFormation log files.</span>
<span class="sd">    :param testdata_list: List of TestData objects</span>
<span class="sd">    :param logpath: Log file path</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;(Collecting CloudFormation Logs)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
            <span class="n">stackinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
            <span class="n">stackname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">])</span>
            <span class="n">region</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
            <span class="n">test_logpath</span> <span class="o">=</span> <span class="s1">&#39;{}/{}-{}-{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">logpath</span><span class="p">,</span>
                <span class="n">stackname</span><span class="p">,</span>
                <span class="n">region</span><span class="p">,</span>
                <span class="s1">&#39;cfnlogs&#39;</span><span class="p">,</span>
                <span class="n">extension</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_logs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]),</span> <span class="n">test_logpath</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.createreport">
    <p>def <span class="ident">createreport</span>(</p><p>self, testdata_list, filename)</p>
    </div>




    <div class="desc"><p>This function creates the test report.</p>
<p>:param testdata_list: List of TestData objects
:param filename: Report file name
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.createreport', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.createreport" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createreport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function creates the test report.</span>
<span class="sd">    :param testdata_list: List of TestData objects</span>
<span class="sd">    :param filename: Report file name</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">o_directory</span> <span class="o">=</span> <span class="s1">&#39;taskcat_outputs&#39;</span>
    <span class="c1"># noinspection PyBroadException</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">o_directory</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">o_directory</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |GENERATING REPORTS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Creating report in [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">o_directory</span><span class="p">)</span>
    <span class="n">dashboard_filename</span> <span class="o">=</span> <span class="n">o_directory</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
    <span class="c1"># Collect recursive logs</span>
    <span class="c1"># file path is already setup by getofile function in genreports</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">createcfnlogs</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">,</span> <span class="n">o_directory</span><span class="p">)</span>
    <span class="c1"># Generate html test dashboard</span>
    <span class="c1"># Uses logpath + region to create View Logs link</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genreport</span><span class="p">(</span><span class="n">testdata_list</span><span class="p">,</span> <span class="n">dashboard_filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.deep_cleanup">
    <p>def <span class="ident">deep_cleanup</span>(</p><p>self, testdata_list)</p>
    </div>




    <div class="desc"><p>This function deletes the AWS resources which were not deleted
by deleting CloudFormation stacks.</p>
<p>:param testdata_list: List of TestData objects</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.deep_cleanup', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.deep_cleanup" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">deep_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function deletes the AWS resources which were not deleted</span>
<span class="sd">    by deleting CloudFormation stacks.</span>
<span class="sd">    :param testdata_list: List of TestData objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
        <span class="n">failed_stack_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;DELETE_FAILED&#39;</span><span class="p">:</span>
                <span class="n">failed_stack_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_stack_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;All stacks deleted successfully. Deep clean-up not required.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Few stacks failed to delete. Collecting resources for deep clean-up.&quot;</span><span class="p">)</span>
        <span class="c1"># get test region from the stack id</span>
        <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">failed_stack_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Sweeper</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
        <span class="n">failed_stacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_resources</span><span class="p">(</span><span class="n">failed_stack_ids</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="c1"># print all resources which failed to delete</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Resources which failed to delete:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">failed_stack</span> <span class="ow">in</span> <span class="n">failed_stacks</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Stack Id: &quot;</span> <span class="o">+</span> <span class="n">failed_stack</span><span class="p">[</span><span class="s1">&#39;stackId&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">failed_stack</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;{0} = {1}, {2} = {3}, {4} = {5}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">LogicalId&#39;</span><span class="p">,</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logicalId&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">PhysicalId&#39;</span><span class="p">,</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;physicalId&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">Type&#39;</span><span class="p">,</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resourceType&#39;</span><span class="p">)</span>
                    <span class="p">))</span>
            <span class="n">s</span><span class="o">.</span><span class="n">delete_all</span><span class="p">(</span><span class="n">failed_stacks</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.define_tests">
    <p>def <span class="ident">define_tests</span>(</p><p>self, yamlc, test)</p>
    </div>




    <div class="desc"><p>This function reads the given test config yaml object and defines
the tests as per the given config object.</p>
<p>:param yamlc: TaskCat config yaml object
:param test: Test scenarios</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.define_tests', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.define_tests" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">define_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yamlc</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function reads the given test config yaml object and defines</span>
<span class="sd">    the tests as per the given config object.</span>
<span class="sd">    :param yamlc: TaskCat config yaml object</span>
<span class="sd">    :param test: Test scenarios</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">tdefs</span> <span class="ow">in</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># print(&quot;[DEBUG] tdefs = %s&quot; % tdefs)</span>
        <span class="k">if</span> <span class="n">tdefs</span> <span class="o">==</span> <span class="n">test</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;template_file&#39;</span><span class="p">]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;parameter_input&#39;</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;qsname&#39;</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">()</span>
            <span class="c1"># Checks if cleanup flag is set</span>
            <span class="c1"># If cleanup is set to &#39;false&#39; stack will not be deleted after</span>
            <span class="c1"># launch attempt</span>
            <span class="k">if</span> <span class="s1">&#39;cleanup&#39;</span> <span class="ow">in</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">cleanupstack</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;cleanup&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cleanupstack</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;cleanup set to ymal value&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_docleanup</span><span class="p">(</span><span class="n">cleanupstack</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Cleanup value set to (false)&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_docleanup</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># By default do cleanup unless self.run_cleanup</span>
                <span class="c1"># was overwridden (set to False) by -n flag</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;cleanup set by cli flag {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_docleanup</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;No cleanup value set&quot;</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot; - (Defaulting to cleanup)&quot;</span><span class="p">)</span>
            <span class="c1"># Load test setting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_s3bucket</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_project</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_template_file</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_file</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_template_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">()))</span>
            <span class="c1"># Check to make sure template filenames are correct</span>
            <span class="n">template_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">template_path</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Could not locate {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Check to make sure filename is correct?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">()))</span>
                <span class="n">quit</span><span class="p">()</span>
            <span class="c1"># Check to make sure parameter filenames are correct</span>
            <span class="n">parameter_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parameter_path</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Could not locate {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">()))</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0} Check to make sure filename is correct?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">()))</span>
                <span class="n">quit</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;|Acquiring tests assets for .......[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|S3 Bucket  =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Project    =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Template   =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">())</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Parameter  =&gt; [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span>
            <span class="k">if</span> <span class="s1">&#39;regions&#39;</span> <span class="ow">in</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">yamlc</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_test_region</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Defined Regions:&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">list_o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_region</span><span class="p">():</span>
                            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="s2"> - [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">list_o</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">global_regions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_region</span><span class="p">(</span><span class="n">yamlc</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_test_region</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">global_regions</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;|Global Regions:&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">list_o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_region</span><span class="p">():</span>
                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="s2"> - [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">list_o</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="s2">&quot;(Completed) acquisition of [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.genpassword">
    <p>def <span class="ident">genpassword</span>(</p><p>self, pass_length, pass_type)</p>
    </div>




    <div class="desc"><p>Returns a password of given length and type.</p>
<p>:param pass_length: Length of the desired password
:param pass_type: Type of the desired password - String only OR Alphanumeric
    * A = AlphaNumeric, Example 'vGceIP8EHC'
:return: Password of given length and type</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.genpassword', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.genpassword" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">genpassword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pass_length</span><span class="p">,</span> <span class="n">pass_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a password of given length and type.</span>
<span class="sd">    :param pass_length: Length of the desired password</span>
<span class="sd">    :param pass_type: Type of the desired password - String only OR Alphanumeric</span>
<span class="sd">        * A = AlphaNumeric, Example &#39;vGceIP8EHC&#39;</span>
<span class="sd">    :return: Password of given length and type</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Auto generating password&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass size =&gt; {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pass_length</span><span class="p">))</span>
    <span class="n">password</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">numbers</span> <span class="o">=</span> <span class="s2">&quot;1234567890&quot;</span>
    <span class="n">lowercase</span> <span class="o">=</span> <span class="s2">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
    <span class="n">uppercase</span> <span class="o">=</span> <span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>
    <span class="n">specialchars</span> <span class="o">=</span> <span class="s2">&quot;!#$&amp;{*:[=,]-_%@+&quot;</span>
    <span class="c1"># Generates password string with:</span>
    <span class="c1"># lowercase,uppercase and numeric chars</span>
    <span class="k">if</span> <span class="n">pass_type</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass type =&gt; {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;alpha-numeric&#39;</span><span class="p">))</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pass_length</span><span class="p">:</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lowercase</span><span class="p">))</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">uppercase</span><span class="p">))</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
    <span class="c1"># Generates password string with:</span>
    <span class="c1"># lowercase,uppercase, numbers and special chars</span>
    <span class="k">elif</span> <span class="n">pass_type</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass type =&gt; (&#39;specialchars&#39;)&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pass_length</span><span class="p">:</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lowercase</span><span class="p">))</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">uppercase</span><span class="p">))</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">specialchars</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If no passtype is defined (None)</span>
        <span class="c1"># Defaults to alpha-numeric</span>
        <span class="c1"># Generates password string with:</span>
        <span class="c1"># lowercase,uppercase, numbers and special chars</span>
        <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Pass type =&gt; default (&#39;alpha-numeric&#39;)&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pass_length</span><span class="p">:</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">lowercase</span><span class="p">))</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">uppercase</span><span class="p">))</span>
            <span class="n">password</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">numbers</span><span class="p">))</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.genreport">
    <p>def <span class="ident">genreport</span>(</p><p>self, testdata_list, dashboard_filename)</p>
    </div>




    <div class="desc"><p>This function generates the test report.</p>
<p>:param testdata_list: List of TestData objects
:param dashboard_filename: Report file name</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.genreport', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.genreport" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">genreport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">dashboard_filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function generates the test report.</span>
<span class="sd">    :param testdata_list: List of TestData objects</span>
<span class="sd">    :param dashboard_filename: Report file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">yattag</span><span class="o">.</span><span class="n">Doc</span><span class="p">()</span>
    <span class="c1"># Type of cfnlog return cfn log file</span>
    <span class="c1"># Type of resource_log return resource log file</span>
    <span class="k">def</span> <span class="nf">getofile</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">):</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;.txt&#39;</span>
        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s1">&#39;cfnlog&#39;</span><span class="p">:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;{}-{}-{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack_name</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="s1">&#39;cfnlogs&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s1">&#39;resource_log&#39;</span><span class="p">:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;{}-{}-{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack_name</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_teststate</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
        <span class="c1"># Add try catch and return MANUALLY_DELETED</span>
        <span class="c1"># Add css test-orange</span>
        <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="n">test_query</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">describe_stacks</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
        <span class="n">rstatus</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">status_css</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">test_query</span><span class="p">[</span><span class="s1">&#39;Stacks&#39;</span><span class="p">]:</span>
            <span class="n">rstatus</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackStatus&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rstatus</span> <span class="o">==</span> <span class="s1">&#39;CREATE_COMPLETE&#39;</span><span class="p">:</span>
                <span class="n">status_css</span> <span class="o">=</span> <span class="s1">&#39;class=test-green&#39;</span>
            <span class="k">elif</span> <span class="n">rstatus</span> <span class="o">==</span> <span class="s1">&#39;CREATE_FAILED&#39;</span><span class="p">:</span>
                <span class="n">status_css</span> <span class="o">=</span> <span class="s1">&#39;class=test-red&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">status_css</span> <span class="o">=</span> <span class="s1">&#39;class=test-red&#39;</span>
        <span class="k">return</span> <span class="n">rstatus</span><span class="p">,</span> <span class="n">status_css</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">tag</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">text</span>
    <span class="n">logo</span> <span class="o">=</span> <span class="s1">&#39;taskcat&#39;</span>
    <span class="n">repo_link</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/aws-quickstart/taskcat&#39;</span>
    <span class="n">output_css</span> <span class="o">=</span> <span class="s1">&#39;https://taskcat.s3.amazonaws.com/assets/css/taskcat.css&#39;</span>
    <span class="n">doc_link</span> <span class="o">=</span> <span class="s1">&#39;http://taskcat.io&#39;</span>
    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">):</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span>
                <span class="s1">&#39;meta&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;width=device-width&quot;</span><span class="p">)</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="s1">&#39;stylesheet&#39;</span><span class="p">,</span>
                     <span class="n">href</span><span class="o">=</span><span class="n">output_css</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">):</span>
                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;TaskCat Report&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">):</span>
            <span class="n">tested_on</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%A - %b,</span><span class="si">%d</span><span class="s1">,%Y @ %H:%M:%S&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;class=header-table-fill&#39;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span> <span class="s1">&#39;colspan=2&#39;</span><span class="p">):</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">):</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">repo_link</span><span class="p">):</span>
                                    <span class="n">text</span><span class="p">(</span><span class="s1">&#39;GitHub Repo: &#39;</span><span class="p">)</span>
                                    <span class="n">text</span><span class="p">(</span><span class="n">repo_link</span><span class="p">)</span>
                                    <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;br&#39;</span><span class="p">)</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">doc_link</span><span class="p">):</span>
                                    <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Documentation: &#39;</span><span class="p">)</span>
                                    <span class="n">text</span><span class="p">(</span><span class="n">doc_link</span><span class="p">)</span>
                                    <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;br&#39;</span><span class="p">)</span>
                                <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Tested on: &#39;</span><span class="p">)</span>
                                <span class="n">text</span><span class="p">(</span><span class="n">tested_on</span><span class="p">)</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;class=taskcat-logo&#39;</span><span class="p">):</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">):</span>
                                    <span class="n">text</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;class=table-fill&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;thread&#39;</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;class=text-center&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;width=25%&#39;</span><span class="p">):</span>
                            <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Test Name&#39;</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;width=10%&#39;</span><span class="p">):</span>
                            <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Tested Region&#39;</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;width=30%&#39;</span><span class="p">):</span>
                            <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Stack Name&#39;</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;width=20%&#39;</span><span class="p">):</span>
                            <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Tested Results&#39;</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;class=text-left&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;width=15%&#39;</span><span class="p">):</span>
                            <span class="n">text</span><span class="p">(</span><span class="s1">&#39;Test Logs&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">,</span> <span class="s1">&#39;class= test-footer&#39;</span><span class="p">):</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;colspan=5&#39;</span><span class="p">):</span>
                                    <span class="n">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="n">testname</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">()</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;(Generating Reports)&quot;</span><span class="p">)</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot; - Processing {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">testname</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                                <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                                    <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                                <span class="n">status</span><span class="p">,</span> <span class="n">css</span> <span class="o">=</span> <span class="n">get_teststate</span><span class="p">(</span>
                                    <span class="n">state</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">],</span>
                                    <span class="n">state</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
                                <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">):</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;class=test-info&#39;</span><span class="p">):</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;h3&#39;</span><span class="p">):</span>
                                            <span class="n">text</span><span class="p">(</span><span class="n">testname</span><span class="p">)</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;class=text-left&#39;</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;class=text-left&#39;</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">])</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="n">css</span><span class="p">):</span>
                                        <span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
                                    <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;class=text-left&#39;</span><span class="p">):</span>
                                        <span class="n">clog</span> <span class="o">=</span> <span class="n">getofile</span><span class="p">(</span>
                                            <span class="n">state</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">],</span>
                                            <span class="n">state</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">],</span>
                                            <span class="s1">&#39;cfnlog&#39;</span><span class="p">)</span>
                                        <span class="c1"># rlog = getofile(</span>
                                        <span class="c1">#    state[&#39;region&#39;],</span>
                                        <span class="c1">#    state[&#39;stack_name&#39;],</span>
                                        <span class="c1">#    &#39;resource_log&#39;)</span>
                                        <span class="c1">#</span>
                                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">clog</span><span class="p">):</span>
                                            <span class="n">text</span><span class="p">(</span><span class="s1">&#39;View Logs &#39;</span><span class="p">)</span>
                                            <span class="c1"># with tag(&#39;a&#39;, href=rlog):</span>
                                            <span class="c1">#    text(&#39;Resource Logs &#39;)</span>
                        <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">,</span> <span class="s1">&#39;class= test-footer&#39;</span><span class="p">):</span>
                            <span class="k">with</span> <span class="n">tag</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;colspan=5&#39;</span><span class="p">):</span>
                                <span class="n">vtag</span> <span class="o">=</span> <span class="s1">&#39;Generated by {} {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;taskcat&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
                                <span class="n">text</span><span class="p">(</span><span class="n">vtag</span><span class="p">)</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">stag</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">htmloutput</span> <span class="o">=</span> <span class="n">yattag</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
                               <span class="n">indentation</span><span class="o">=</span><span class="s1">&#39;    &#39;</span><span class="p">,</span>
                               <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">,</span>
                               <span class="n">indent_text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dashboard_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">htmloutput</span><span class="p">)</span>
    <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">htmloutput</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_all_resources">
    <p>def <span class="ident">get_all_resources</span>(</p><p>self, stackids, region)</p>
    </div>




    <div class="desc"><p>Given a list of stackids, function returns the list of dictionary items, where each
item consist of stackId and the resources associated with that stack.</p>
<p>:param stackids: List of Stack Ids
:param region: AWS region
:return: A list of dictionary object in the following format
        [
            {
                'stackId': 'string',
                'resources': [
                    {
                       'logicalId': 'string',
                       'physicalId': 'string',
                       'resourceType': 'String'
                    },
                ]
            },
        ]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_all_resources', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_all_resources" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_all_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackids</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of stackids, function returns the list of dictionary items, where each</span>
<span class="sd">    item consist of stackId and the resources associated with that stack.</span>
<span class="sd">    :param stackids: List of Stack Ids</span>
<span class="sd">    :param region: AWS region</span>
<span class="sd">    :return: A list of dictionary object in the following format</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;stackId&#39;: &#39;string&#39;,</span>
<span class="sd">                    &#39;resources&#39;: [</span>
<span class="sd">                        {</span>
<span class="sd">                           &#39;logicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                           &#39;physicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                           &#39;resourceType&#39;: &#39;String&#39;</span>
<span class="sd">                        },</span>
<span class="sd">                    ]</span>
<span class="sd">                },</span>
<span class="sd">            ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l_all_resources</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">anId</span> <span class="ow">in</span> <span class="n">stackids</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;stackId&#39;</span><span class="p">:</span> <span class="n">anId</span><span class="p">,</span>
            <span class="s1">&#39;resources&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span><span class="n">anId</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">l_all_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l_all_resources</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_available_azs">
    <p>def <span class="ident">get_available_azs</span>(</p><p>region, count)</p>
    </div>




    <div class="desc"><p>Returns a list of availability zones in a given region.</p>
<p>:param region: Region for the availability zones
:param count: Minimum number of availability zones needed</p>
<p>:return: List of availability zones in a given region</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_available_azs', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_available_azs" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_available_azs</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of availability zones in a given region.</span>
<span class="sd">    :param region: Region for the availability zones</span>
<span class="sd">    :param count: Minimum number of availability zones needed</span>
<span class="sd">    :return: List of availability zones in a given region</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">available_azs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
    <span class="n">availability_zones</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_availability_zones</span><span class="p">(</span>
        <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;Values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]}])</span>
    <span class="k">for</span> <span class="n">az</span> <span class="ow">in</span> <span class="n">availability_zones</span><span class="p">[</span><span class="s1">&#39;AvailabilityZones&#39;</span><span class="p">]:</span>
        <span class="n">available_azs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">az</span><span class="p">[</span><span class="s1">&#39;ZoneName&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_azs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}!Only {1} az&#39;s are available in {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_azs</span><span class="p">),</span> <span class="n">region</span><span class="p">))</span>
        <span class="n">quit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">azs</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available_azs</span><span class="p">[:</span><span class="n">count</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">azs</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_capabilities">
    <p>def <span class="ident">get_capabilities</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_capabilities', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_capabilities" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_cfnlogs">
    <p>def <span class="ident">get_cfnlogs</span>(</p><p>stackname, region)</p>
    </div>




    <div class="desc"><p>This function returns the event logs of the given stack in a specific format.
:param stackname: Name of the stack
:param region: Region stack belongs to
:return: Event logs of the stack</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_cfnlogs', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_cfnlogs" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_cfnlogs</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function returns the event logs of the given stack in a specific format.</span>
<span class="sd">    :param stackname: Name of the stack</span>
<span class="sd">    :param region: Region stack belongs to</span>
<span class="sd">    :return: Event logs of the stack</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Collecting logs for &quot;</span> <span class="o">+</span> <span class="n">stackname</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Collect stack_events</span>
    <span class="n">stack_events</span> <span class="o">=</span> <span class="n">get_cfn_stack_events</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    <span class="c1"># Uncomment line for debug</span>
    <span class="c1"># pprint.pprint (stack_events)</span>
    <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">stack_events</span><span class="p">:</span>
        <span class="n">event_details</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TimeStamp&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">],</span>
                         <span class="s1">&#39;ResourceStatus&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ResourceStatus&#39;</span><span class="p">],</span>
                         <span class="s1">&#39;ResourceType&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">],</span>
                         <span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">]}</span>
        <span class="k">if</span> <span class="s1">&#39;ResourceStatusReason&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="n">event_details</span><span class="p">[</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event_details</span><span class="p">[</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_details</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">events</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_config">
    <p>def <span class="ident">get_config</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_config', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_config" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_default_region">
    <p>def <span class="ident">get_default_region</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_default_region', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_default_region" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_default_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defult_region</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_docleanup">
    <p>def <span class="ident">get_docleanup</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_docleanup', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_docleanup" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_docleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_global_region">
    <p>def <span class="ident">get_global_region</span>(</p><p>self, yamlcfg)</p>
    </div>




    <div class="desc"><p>Returns a list of regions defined under global region in the yml config file.</p>
<p>:param yamlcfg: Content of the yml config file
:return: List of regions</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_global_region', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_global_region" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_global_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yamlcfg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of regions defined under global region in the yml config file.</span>
<span class="sd">    :param yamlcfg: Content of the yml config file</span>
<span class="sd">    :return: List of regions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g_regions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">yamlcfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;region&#39;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">iter</span><span class="p">(</span><span class="n">yamlcfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">])</span>
                <span class="n">namespace</span> <span class="o">=</span> <span class="s1">&#39;global&#39;</span>
                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">yamlcfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;regions&#39;</span><span class="p">]:</span>
                    <span class="c1"># print(&quot;found region %s&quot; % region)</span>
                    <span class="n">g_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_use_global</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No regions defined in [</span><span class="si">%s</span><span class="s2">]:&quot;</span> <span class="o">%</span> <span class="n">namespace</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Please correct region defs[</span><span class="si">%s</span><span class="s2">]:&quot;</span> <span class="o">%</span> <span class="n">namespace</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">g_regions</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_parameter_file">
    <p>def <span class="ident">get_parameter_file</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_parameter_file', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_parameter_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_parameter_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_file</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_parameter_path">
    <p>def <span class="ident">get_parameter_path</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_parameter_path', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_parameter_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_parameter_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_password">
    <p>def <span class="ident">get_password</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_password', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_password" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_password</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_project">
    <p>def <span class="ident">get_project</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_project', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_project" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_resources">
    <p>def <span class="ident">get_resources</span>(</p><p>self, stackname, region, include_stacks=False)</p>
    </div>




    <div class="desc"><p>Given a stackname, and region function returns the list of dictionary items, where each item
consist of logicalId, physicalId and resourceType of the aws resource associated
with the stack.</p>
<p>:param include_stacks: 
:param stackname: CloudFormation stack name
:param region: AWS region
:return: List of objects in the following format
     [
         {
             'logicalId': 'string',
             'physicalId': 'string',
             'resourceType': 'String'
         },
     ]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_resources', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_resources" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">include_stacks</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a stackname, and region function returns the list of dictionary items, where each item</span>
<span class="sd">    consist of logicalId, physicalId and resourceType of the aws resource associated</span>
<span class="sd">    with the stack.</span>
<span class="sd">    :param include_stacks: </span>
<span class="sd">    :param stackname: CloudFormation stack name</span>
<span class="sd">    :param region: AWS region</span>
<span class="sd">    :return: List of objects in the following format</span>
<span class="sd">         [</span>
<span class="sd">             {</span>
<span class="sd">                 &#39;logicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                 &#39;physicalId&#39;: &#39;string&#39;,</span>
<span class="sd">                 &#39;resourceType&#39;: &#39;String&#39;</span>
<span class="sd">             },</span>
<span class="sd">         ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l_resources</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">get_resources_helper</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">l_resources</span><span class="p">,</span> <span class="n">include_stacks</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l_resources</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_resources_helper">
    <p>def <span class="ident">get_resources_helper</span>(</p><p>self, stackname, region, l_resources, include_stacks)</p>
    </div>




    <div class="desc"><p>This is a helper function of get_resources function. Check get_resources function for details.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_resources_helper', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_resources_helper" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_resources_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">l_resources</span><span class="p">,</span> <span class="n">include_stacks</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a helper function of get_resources function. Check get_resources function for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stackname</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">describe_stack_resources</span><span class="p">(</span>
                <span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
            <span class="n">stackresources</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackResources&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">stackresources</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Resources: for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stackname</span><span class="p">))</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;{0} = {1}, {2} = {3}, {4} = {5}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">LogicalId&#39;</span><span class="p">,</span>
                        <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">PhysicalId&#39;</span><span class="p">,</span>
                        <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;</span><span class="se">\n\t\t</span><span class="s1">Type&#39;</span><span class="p">,</span>
                        <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">)</span>
                    <span class="p">))</span>
                <span class="c1"># if resource is a stack and has a physical resource id (NOTE: physical id will be missing if stack creation is failed)</span>
                <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;ResourceType&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;AWS::CloudFormation::Stack&#39;</span> <span class="ow">and</span> <span class="s1">&#39;PhysicalResourceId&#39;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">include_stacks</span><span class="p">:</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;physicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span>
                             <span class="s1">&#39;resourceType&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">)}</span>
                        <span class="n">l_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">)))</span>
                    <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_resources_helper</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span> <span class="n">region</span><span class="p">,</span> <span class="n">l_resources</span><span class="p">,</span>
                                              <span class="n">include_stacks</span><span class="p">)</span>
                <span class="c1"># else if resource is not a stack and has a physical resource id (NOTE: physical id will be missing if stack creation is failed)</span>
                <span class="k">elif</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;ResourceType&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;AWS::CloudFormation::Stack&#39;</span> <span class="ow">and</span> <span class="s1">&#39;PhysicalResourceId&#39;</span> <span class="ow">in</span> <span class="n">resource</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LogicalResourceId&#39;</span><span class="p">),</span>
                         <span class="s1">&#39;physicalId&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PhysicalResourceId&#39;</span><span class="p">),</span>
                         <span class="s1">&#39;resourceType&#39;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ResourceType&#39;</span><span class="p">)}</span>
                    <span class="n">l_resources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Unable to get resources for stack </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stackname</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_s3_url">
    <p>def <span class="ident">get_s3_url</span>(</p><p>self, key)</p>
    </div>




    <div class="desc"><p>Returns S3 url of a given object.</p>
<p>:param key: Name of the object whose S3 url is being returned
:return: S3 url of the given key</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_s3_url', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_s3_url" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns S3 url of a given object.</span>
<span class="sd">    :param key: Name of the object whose S3 url is being returned</span>
<span class="sd">    :return: S3 url of the given key</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">Config</span><span class="p">(</span><span class="n">signature_version</span><span class="o">=</span><span class="s1">&#39;s3v4&#39;</span><span class="p">))</span>
    <span class="n">bucket_location</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_bucket_location</span><span class="p">(</span>
        <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">())</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span>
                                 <span class="n">Prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">())</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Contents&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s3obj</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">s3obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Key&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># Finding exact match</span>
                    <span class="n">terms</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">terms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">bucket_location</span><span class="p">[</span>
                            <span class="s1">&#39;LocationConstraint&#39;</span>
                        <span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">o_url</span> <span class="o">=</span> <span class="s2">&quot;https://s3-{0}.{1}/{2}/{3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">bucket_location</span><span class="p">[</span><span class="s1">&#39;LocationConstraint&#39;</span><span class="p">],</span>
                                <span class="s2">&quot;amazonaws.com&quot;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span>
                                <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">return</span> <span class="n">o_url</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">amzns3</span> <span class="o">=</span> <span class="s1">&#39;s3.amazonaws.com&#39;</span>
                            <span class="n">o_url</span> <span class="o">=</span> <span class="s2">&quot;https://{0}/{1}/{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amzns3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span> <span class="n">metadata</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">return</span> <span class="n">o_url</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_s3bucket">
    <p>def <span class="ident">get_s3bucket</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_s3bucket', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_s3bucket" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_s3bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_s3contents">
    <p>def <span class="ident">get_s3contents</span>(</p><p>url)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_s3contents', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_s3contents" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_s3contents</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">payload</span><span class="o">.</span><span class="n">text</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_stackstatus">
    <p>def <span class="ident">get_stackstatus</span>(</p><p>self, testdata_list, speed)</p>
    </div>




    <div class="desc"><p>Given a list of TestData objects, this function checks the stack status
of each CloudFormation stack and updates the corresponding TestData object
with the status.</p>
<p>:param testdata_list: List of TestData object
:param speed: Interval (in seconds) in which the status has to be checked in loop</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_stackstatus', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_stackstatus" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_stackstatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a list of TestData objects, this function checks the stack status</span>
<span class="sd">    of each CloudFormation stack and updates the corresponding TestData object</span>
<span class="sd">    with the status.</span>
<span class="sd">    :param testdata_list: List of TestData object</span>
<span class="sd">    :param speed: Interval (in seconds) in which the status has to be checked in loop</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">active_tests</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">active_tests</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">current_active_tests</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;{}{} {} [{}]{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">header</span><span class="p">,</span>
            <span class="s1">&#39;AWS REGION&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
            <span class="s1">&#39;CLOUDFORMATION STACK STATUS&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
            <span class="s1">&#39;CLOUDFORMATION STACK NAME&#39;</span><span class="p">,</span>
            <span class="n">rst_color</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
                <span class="n">stackquery</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stackcheck</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
                <span class="n">current_active_tests</span> <span class="o">=</span> <span class="n">stackquery</span><span class="p">[</span>
                                           <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">current_active_tests</span>
                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;{3}{0} {1} [{2}]{4}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">stackquery</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
                    <span class="n">stackquery</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span>
                    <span class="n">stackquery</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">hightlight</span><span class="p">,</span>
                    <span class="n">rst_color</span><span class="p">))</span>
                <span class="n">stack</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stackquery</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">active_tests</span> <span class="o">=</span> <span class="n">current_active_tests</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_template_file">
    <p>def <span class="ident">get_template_file</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_template_file', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_template_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_template_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template_file</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_template_path">
    <p>def <span class="ident">get_template_path</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_template_path', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_template_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_template_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.get_test_region">
    <p>def <span class="ident">get_test_region</span>(</p><p>self)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.get_test_region', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.get_test_region" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_test_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.if_stackexists">
    <p>def <span class="ident">if_stackexists</span>(</p><p>self, stackname, region)</p>
    </div>




    <div class="desc"><p>This function checks if a stack exist with the given stack name.
Returns "yes" if exist, otherwise "no".</p>
<p>:param stackname: Stack name
:param region: AWS region</p>
<p>:return: "yes" if stack exist, otherwise "no"</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.if_stackexists', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.if_stackexists" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">if_stackexists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function checks if a stack exist with the given stack name.</span>
<span class="sd">    Returns &quot;yes&quot; if exist, otherwise &quot;no&quot;.</span>
<span class="sd">    :param stackname: Stack name</span>
<span class="sd">    :param region: AWS region</span>
<span class="sd">    :return: &quot;yes&quot; if stack exist, otherwise &quot;no&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exists</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cfn</span><span class="o">.</span><span class="n">describe_stacks</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">)</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">exists</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Successfully Deleted[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">stackname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">exists</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.parse_stack_info">
    <p>def <span class="ident">parse_stack_info</span>(</p><p>self, stack_name)</p>
    </div>




    <div class="desc"><p>Returns a dictionary object containing the region and stack name.</p>
<p>:param stack_name: Full stack name arn
:return: Dictionary object containing the region and stack name</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.parse_stack_info', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.parse_stack_info" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parse_stack_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a dictionary object containing the region and stack name.</span>
<span class="sd">    :param stack_name: Full stack name arn</span>
<span class="sd">    :return: Dictionary object containing the region and stack name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stack_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">region_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=:)(.\w-.+(\w*)-\d)(?=:)&#39;</span><span class="p">)</span>
    <span class="n">stack_name_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=:stack/)(tCaT.*.)(?=/)&#39;</span><span class="p">)</span>
    <span class="n">stack_info</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">region_re</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">)</span>
    <span class="n">stack_info</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">stack_name_re</span><span class="p">,</span> <span class="n">stack_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stack_info</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.regxfind">
    <p>def <span class="ident">regxfind</span>(</p><p>re_object, data_line)</p>
    </div>




    <div class="desc"><p>Returns the matching string.</p>
<p>:param re_object: Regex object
:param data_line: String to be searched</p>
<p>:return: Matching String if found, otherwise return 'Not-found'</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.regxfind', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.regxfind" class="source">
    <div class="codehilite"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">regxfind</span><span class="p">(</span><span class="n">re_object</span><span class="p">,</span> <span class="n">data_line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the matching string.</span>
<span class="sd">    :param re_object: Regex object</span>
<span class="sd">    :param data_line: String to be searched</span>
<span class="sd">    :return: Matching String if found, otherwise return &#39;Not-found&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sg</span> <span class="o">=</span> <span class="n">re_object</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">data_line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sg</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Not-found&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_capabilities">
    <p>def <span class="ident">set_capabilities</span>(</p><p>self, ability)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_capabilities', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_capabilities" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ability</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ability</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_config">
    <p>def <span class="ident">set_config</span>(</p><p>self, config_yml)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_config', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_config" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_yml</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">config_yml</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config_yml</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Cannot locate file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">config_yml</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_default_region">
    <p>def <span class="ident">set_default_region</span>(</p><p>self, region)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_default_region', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_default_region" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_default_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">defult_region</span> <span class="o">=</span> <span class="n">region</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_docleanup">
    <p>def <span class="ident">set_docleanup</span>(</p><p>self, cleanup_value)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_docleanup', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_docleanup" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_docleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cleanup_value</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_cleanup</span> <span class="o">=</span> <span class="n">cleanup_value</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_parameter_file">
    <p>def <span class="ident">set_parameter_file</span>(</p><p>self, parameter)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_parameter_file', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_parameter_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_parameter_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parameter_file</span> <span class="o">=</span> <span class="n">parameter</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_parameter_path">
    <p>def <span class="ident">set_parameter_path</span>(</p><p>self, parameter)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_parameter_path', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_parameter_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_parameter_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span> <span class="o">=</span> <span class="n">parameter</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_password">
    <p>def <span class="ident">set_password</span>(</p><p>self, password)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_password', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_password" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="n">password</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_project">
    <p>def <span class="ident">set_project</span>(</p><p>self, project)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_project', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_project" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_s3bucket">
    <p>def <span class="ident">set_s3bucket</span>(</p><p>self, bucket)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_s3bucket', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_s3bucket" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_s3bucket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s3bucket</span> <span class="o">=</span> <span class="n">bucket</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_template_file">
    <p>def <span class="ident">set_template_file</span>(</p><p>self, template)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_template_file', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_template_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_template_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_template_file</span> <span class="o">=</span> <span class="n">template</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_template_path">
    <p>def <span class="ident">set_template_path</span>(</p><p>self, template)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_template_path', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_template_path" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_template_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_path</span> <span class="o">=</span> <span class="n">template</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.set_test_region">
    <p>def <span class="ident">set_test_region</span>(</p><p>self, region_list)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.set_test_region', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.set_test_region" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_test_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_list</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">region_list</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_region</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.stackcheck">
    <p>def <span class="ident">stackcheck</span>(</p><p>self, stack_id)</p>
    </div>




    <div class="desc"><p>Given the stack id, this function returns the status of the stack as
a list with stack name, region, and status as list items, in the respective
order.</p>
<p>:param stack_id: CloudFormation stack id</p>
<p>:return: List containing the stack name, region and stack status in the
    respective order.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.stackcheck', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.stackcheck" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">stackcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given the stack id, this function returns the status of the stack as</span>
<span class="sd">    a list with stack name, region, and status as list items, in the respective</span>
<span class="sd">    order.</span>
<span class="sd">    :param stack_id: CloudFormation stack id</span>
<span class="sd">    :return: List containing the stack name, region and stack status in the</span>
<span class="sd">        respective order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="n">stack_id</span><span class="p">)</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
    <span class="n">stack_name</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]</span>
    <span class="n">test_info</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    <span class="c1"># noinspection PyBroadException</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">test_query</span> <span class="o">=</span> <span class="p">(</span><span class="n">cfn</span><span class="o">.</span><span class="n">describe_stacks</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stack_name</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">test_query</span><span class="p">[</span><span class="s1">&#39;Stacks&#39;</span><span class="p">]:</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack_name</span><span class="p">)</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
            <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackStatus&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;StackStatus&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;CREATE_IN_PROGRESS&#39;</span> <span class="ow">or</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StackStatus&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;DELETE_IN_PROGRESS&#39;</span><span class="p">:</span>
                <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack_name</span><span class="p">)</span>
        <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
        <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;STACK_DELETED&quot;</span><span class="p">)</span>
        <span class="n">test_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_info</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.stackcreate">
    <p>def <span class="ident">stackcreate</span>(</p><p>self, taskcat_cfg, test_list, sprefix)</p>
    </div>




    <div class="desc"><p>This function creates CloudFormation stack for the given tests.</p>
<p>:param taskcat_cfg: TaskCat config as yaml object
:param test_list: List of tests
:param sprefix: Special prefix as string. Purpose of this param is to use it for tagging
    the stack.</p>
<p>:return: List of TestData objects</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.stackcreate', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.stackcreate" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">stackcreate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test_list</span><span class="p">,</span> <span class="n">sprefix</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function creates CloudFormation stack for the given tests.</span>
<span class="sd">    :param taskcat_cfg: TaskCat config as yaml object</span>
<span class="sd">    :param test_list: List of tests</span>
<span class="sd">    :param sprefix: Special prefix as string. Purpose of this param is to use it for tagging</span>
<span class="sd">        the stack.</span>
<span class="sd">    :return: List of TestData objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">testdata_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_capabilities</span><span class="p">(</span><span class="s1">&#39;CAPABILITY_IAM&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">:</span>
        <span class="n">testdata</span> <span class="o">=</span> <span class="n">TestData</span><span class="p">()</span>
        <span class="n">testdata</span><span class="o">.</span><span class="n">set_test_name</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}{1}|PREPARING TO LAUNCH =&gt; {2}{3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
        <span class="n">sname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="n">stackname</span> <span class="o">=</span> <span class="n">sname</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">sprefix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">test</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">jobid</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_tests</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_test_region</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Preparing to launch in region [</span><span class="si">%s</span><span class="s2">] &quot;</span> <span class="o">%</span> <span class="n">region</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
                <span class="n">s_parmsdata</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span><span class="o">.</span><span class="n">text</span>
                <span class="n">s_parms</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s_parmsdata</span><span class="p">)</span>
                <span class="c1"># gentype = None</span>
                <span class="c1"># Auto-generated stack inputs</span>
                <span class="c1"># (Passwords)</span>
                <span class="c1"># Value that matches the following pattern will be replaced</span>
                <span class="c1"># - Parameters must start with $[</span>
                <span class="c1"># - Parameters must end with ]</span>
                <span class="c1"># - genpass in invoked when _genpass_X is found</span>
                <span class="c1"># - X is lengeth of the string</span>
                <span class="c1"># Example: $[taskcat_genpass_8]</span>
                <span class="c1"># Optionally - you can specify the type of password by adding</span>
                <span class="c1"># - A aplha-numeric passwords</span>
                <span class="c1"># - S passwords with special characters</span>
                <span class="c1"># Example: $[taskcat_genpass_8A]</span>
                <span class="c1"># Generates: tI8zN3iX8</span>
                <span class="c1"># or</span>
                <span class="c1"># Example: $[taskcat_genpass_8S]</span>
                <span class="c1"># Generates: mA5@cB5!</span>
                <span class="c1"># (Availablity Zones)</span>
                <span class="c1"># Value that matches the following pattern will be replaced</span>
                <span class="c1"># - Parameters must start with $[</span>
                <span class="c1"># - Parameters must end with ]</span>
                <span class="c1"># - genaz in invoked when _genaz_X is found</span>
                <span class="c1"># - A number of AZ&#39;s will be selected from the region</span>
                <span class="c1">#   the stack is attempting to launch</span>
                <span class="c1"># Example: $[taskcat_genaz_2] (if the region is us-east-2)</span>
                <span class="c1"># Generates: us-east-1a, us-east-2b</span>
                <span class="k">for</span> <span class="n">parmdict</span> <span class="ow">in</span> <span class="n">s_parms</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">parmdict</span><span class="p">:</span>
                        <span class="n">param_value</span> <span class="o">=</span> <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span>
                        <span class="c1"># Determines the size of the password to generate</span>
                        <span class="n">count_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?!\w+_genpass_)\d{1,2}&#39;</span><span class="p">)</span>
                        <span class="c1"># Determines the type of password to generate</span>
                        <span class="n">gentype_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                            <span class="s1">&#39;(?!\w+_genpass_\d{1,2}])([AS])&#39;</span><span class="p">)</span>
                        <span class="c1"># Determines if _genpass has been requested</span>
                        <span class="n">genpass_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                            <span class="s1">&#39;\$\[\w+_genpass?(\w)_\d{1,2}\w?]$&#39;</span><span class="p">)</span>
                        <span class="c1"># Determines if _genaz has been requested</span>
                        <span class="n">genaz_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\$\[\w+_genaz_\d]&#39;</span><span class="p">)</span>
                        <span class="c1"># Determines if s3 replacement was requested</span>
                        <span class="n">gets3replace</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\$\[\w+_url_.+]$&#39;</span><span class="p">)</span>
                        <span class="n">geturl_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?&lt;=._url_)(.+)(?=]$)&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">gets3replace</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param_value</span><span class="p">):</span>
                            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">geturl_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">)</span>
                            <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_s3contents</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Raw content of url {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
                            <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                        <span class="c1"># Autogenerated value to password input in runtime</span>
                        <span class="k">if</span> <span class="n">genpass_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param_value</span><span class="p">):</span>
                            <span class="n">passlen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">count_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">))</span>
                            <span class="n">gentype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span>
                                <span class="n">gentype_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">gentype</span><span class="p">:</span>
                                <span class="c1"># Set default password type</span>
                                <span class="c1"># A vaule of D will generate a simple alpha</span>
                                <span class="c1"># aumeric password</span>
                                <span class="n">gentype</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>
                            <span class="k">if</span> <span class="n">passlen</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}AutoGen values for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">param_value</span><span class="p">))</span>
                                <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genpassword</span><span class="p">(</span>
                                    <span class="n">passlen</span><span class="p">,</span> <span class="n">gentype</span><span class="p">)</span>
                                <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                        <span class="k">if</span> <span class="n">genaz_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">param_value</span><span class="p">):</span>
                            <span class="n">numazs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">regxfind</span><span class="p">(</span><span class="n">count_re</span><span class="p">,</span> <span class="n">param_value</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">numazs</span><span class="p">:</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Selecting availability zones&quot;</span><span class="p">)</span>
                                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Requested </span><span class="si">%s</span><span class="s2"> az&#39;s&quot;</span> <span class="o">%</span> <span class="n">numazs</span><span class="p">)</span>
                                <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available_azs</span><span class="p">(</span>
                                    <span class="n">region</span><span class="p">,</span>
                                    <span class="n">numazs</span><span class="p">)</span>
                                <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;$[taskcat_genaz_(!)]&quot;</span><span class="p">)</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Number of az&#39;s not specified!&quot;</span><span class="p">)</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot; - (Defaulting to 1 az)&quot;</span><span class="p">)</span>
                                <span class="n">param_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_available_azs</span><span class="p">(</span>
                                    <span class="n">region</span><span class="p">,</span>
                                    <span class="mi">1</span><span class="p">)</span>
                                <span class="n">parmdict</span><span class="p">[</span><span class="s1">&#39;ParameterValue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Creating Boto Connection region=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">region</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;StackName=&quot;</span> <span class="o">+</span> <span class="n">stackname</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;DisableRollback=True&quot;</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;TemplateURL=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">())</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Capabilities=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_capabilities</span><span class="p">())</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Parameters:&quot;</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">s_parms</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
                <span class="n">stackdata</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">create_stack</span><span class="p">(</span>
                    <span class="n">StackName</span><span class="o">=</span><span class="n">stackname</span><span class="p">,</span>
                    <span class="n">DisableRollback</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">TemplateURL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_path</span><span class="p">(),</span>
                    <span class="n">Parameters</span><span class="o">=</span><span class="n">s_parms</span><span class="p">,</span>
                    <span class="n">Capabilities</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_capabilities</span><span class="p">())</span>
                <span class="n">testdata</span><span class="o">.</span><span class="n">add_test_stack</span><span class="p">(</span><span class="n">stackdata</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Cannot launch </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">())</span>
        <span class="n">testdata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testdata</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |{}LAUNCHING STACKS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} {}{} {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">I</span><span class="p">,</span>
                <span class="n">header</span><span class="p">,</span>
                <span class="n">test</span><span class="o">.</span><span class="n">get_test_name</span><span class="p">(),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:stack&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">rst_color</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">testdata_list</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.stackdelete">
    <p>def <span class="ident">stackdelete</span>(</p><p>self, testdata_list)</p>
    </div>




    <div class="desc"><p>This function deletes the CloudFormation stacks of the given tests.</p>
<p>:param testdata_list: List of TestData objects</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.stackdelete', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.stackdelete" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">stackdelete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testdata_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function deletes the CloudFormation stacks of the given tests.</span>
<span class="sd">    :param testdata_list: List of TestData objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testdata_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stack</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">get_test_stacks</span><span class="p">():</span>
            <span class="n">stackdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="s1">&#39;StackId&#39;</span><span class="p">]))</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">]</span>
            <span class="n">stack_name</span> <span class="o">=</span> <span class="n">stackdata</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">]</span>
            <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
            <span class="n">cfn</span><span class="o">.</span><span class="n">delete_stack</span><span class="p">(</span><span class="n">StackName</span><span class="o">=</span><span class="n">stack_name</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.stage_in_s3">
    <p>def <span class="ident">stage_in_s3</span>(</p><p>self, taskcat_cfg)</p>
    </div>




    <div class="desc"><p>Upload templates and other artifacts to s3.</p>
<p>This function creates the s3 bucket with name provided in the config yml file. If
no bucket name provided, it creates the s3 bucket using project name provided in
config yml file. And uploads the templates and other artifacts to the s3 bucket.</p>
<p>:param taskcat_cfg: Taskcat configuration provided in yml file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.stage_in_s3', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.stage_in_s3" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">stage_in_s3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload templates and other artifacts to s3.</span>
<span class="sd">    This function creates the s3 bucket with name provided in the config yml file. If</span>
<span class="sd">    no bucket name provided, it creates the s3 bucket using project name provided in</span>
<span class="sd">    config yml file. And uploads the templates and other artifacts to the s3 bucket.</span>
<span class="sd">    :param taskcat_cfg: Taskcat configuration provided in yml file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{} |CONTENTS OF  S3 BUCKET{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">rst_color</span><span class="p">))</span>
    <span class="n">project</span> <span class="o">=</span> <span class="n">taskcat_cfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;qsname&#39;</span><span class="p">]</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;s3bucket&#39;</span> <span class="ow">in</span> <span class="n">taskcat_cfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;s3bucket&#39;</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Staging Bucket =&gt; &quot;</span> <span class="o">+</span> <span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_s3bucket</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">auto_bucket</span> <span class="o">=</span> <span class="s1">&#39;taskcat-&#39;</span> <span class="o">+</span> <span class="n">project</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">jobid</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Staging Bucket =&gt; &quot;</span> <span class="o">+</span> <span class="n">auto_bucket</span><span class="p">)</span>
        <span class="n">s3</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">auto_bucket</span><span class="p">)</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">auto_bucket</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_s3bucket</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_project</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">project</span><span class="p">):</span>
        <span class="n">fsmap</span> <span class="o">=</span> <span class="n">buildmap</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">project</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">example1</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        # Name of example project = [projectx]</span>
<span class="s1">        # Command issued to run taskcat = taskcat.py -c projectx/ci/config.yml</span>
<span class="s1">        Hint: if taskcat.py is not in your path specify the full path to taskcat.py</span>
<span class="s1">        </span>
<span class="s1">        # Example of expected directory/project structure</span>
<span class="s1">        projectx</span>
<span class="s1">         LICENSE.txt</span>
<span class="s1">         ci</span>
<span class="s1">          taskcat.yml         # TaskCat Configuration file</span>
<span class="s1">          projectx-input.json # Inputs to pass during stackcreation</span>
<span class="s1">         scripts</span>
<span class="s1">          project-userdata.sh # Any scripts that is part of this project</span>
<span class="s1">         templates</span>
<span class="s1">             projectx.template</span>
<span class="s1">        # Contents of taskcat.yml</span>
<span class="s1">        global:</span>
<span class="s1">          qsname: projectx</span>
<span class="s1">          regions:</span>
<span class="s1">            - us-east-1</span>
<span class="s1">            - us-west-1</span>
<span class="s1">            - us-west-2</span>
<span class="s1">         </span>
<span class="s1">        tests:</span>
<span class="s1">          projectx-test:</span>
<span class="s1">            template_file: projectx.template</span>
<span class="s1">            parameter_input: projectx-input.json</span>
<span class="s1">            &#39;&#39;&#39;</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\t\t</span><span class="s1"> Hint: The name specfied as value of qsname ({})</span>
<span class="s1">                must match the root directory of your project&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}!Cannot find directory [{1}] in {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">    Example:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">example1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Please cd to where you project is located&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">fsmap</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">upload</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;^./&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">bucket</span><span class="o">.</span><span class="n">Acl</span><span class="p">()</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">ACL</span><span class="o">=</span><span class="s1">&#39;public-read&#39;</span><span class="p">)</span>
            <span class="n">bucket</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                               <span class="n">upload</span><span class="p">,</span>
                               <span class="n">ExtraArgs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ACL&#39;</span><span class="p">:</span> <span class="s1">&#39;public-read&#39;</span><span class="p">})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Cannot Upload to bucket =&gt; </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Check that you bucketname is correct&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">o</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;{0}/{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3bucket</span><span class="p">(),</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.validate_json">
    <p>def <span class="ident">validate_json</span>(</p><p>self, jsonin)</p>
    </div>




    <div class="desc"><p>This function validates the given JSON.</p>
<p>:param jsonin: Json object to be validated</p>
<p>:return: TRUE if given Json is valid, FALSE otherwise.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.validate_json', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.validate_json" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">validate_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function validates the given JSON.</span>
<span class="sd">    :param jsonin: Json object to be validated</span>
<span class="sd">    :return: TRUE if given Json is valid, FALSE otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parms</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jsonin</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parms</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.validate_parameters">
    <p>def <span class="ident">validate_parameters</span>(</p><p>self, taskcat_cfg, test_list)</p>
    </div>




    <div class="desc"><p>This function validates the parameters file of the CloudFormation template.</p>
<p>:param taskcat_cfg: TaskCat config yaml object
:param test_list: List of tests</p>
<p>:return: TRUE if the parameters file is valid, else FALSE</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.validate_parameters', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.validate_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">validate_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function validates the parameters file of the CloudFormation template.</span>
<span class="sd">    :param taskcat_cfg: TaskCat config yaml object</span>
<span class="sd">    :param test_list: List of tests</span>
<span class="sd">    :return: TRUE if the parameters file is valid, else FALSE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_tests</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; |Validate JSON input in test[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;parameter_path = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span>
        <span class="n">inputparms</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_path</span><span class="p">())</span><span class="o">.</span><span class="n">text</span>
        <span class="n">jsonstatus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_json</span><span class="p">(</span><span class="n">inputparms</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;jsonstatus = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">jsonstatus</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">jsonstatus</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="s2">&quot;Validated [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;parameter_file = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">())</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Cannot validate </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_file</span><span class="p">())</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.validate_template">
    <p>def <span class="ident">validate_template</span>(</p><p>self, taskcat_cfg, test_list)</p>
    </div>




    <div class="desc"><p>Returns TRUE if all the template files are valid, otherwise FALSE.</p>
<p>:param taskcat_cfg: TaskCat config object
:param test_list: List of tests</p>
<p>:return: TRUE if templates are valid, else FALSE</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.validate_template', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.validate_template" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">validate_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns TRUE if all the template files are valid, otherwise FALSE.</span>
<span class="sd">    :param taskcat_cfg: TaskCat config object</span>
<span class="sd">    :param test_list: List of tests</span>
<span class="sd">    :return: TRUE if templates are valid, else FALSE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Load global regions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_test_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_region</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Validate Template in test[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_tests</span><span class="p">(</span><span class="n">taskcat_cfg</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Default region [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_region</span><span class="p">())</span>
            <span class="n">cfn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudformation&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_region</span><span class="p">())</span>
            <span class="n">cfn</span><span class="o">.</span><span class="n">validate_template</span><span class="p">(</span><span class="n">TemplateURL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">cfn</span><span class="o">.</span><span class="n">validate_template</span><span class="p">(</span><span class="n">TemplateURL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_s3_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">()))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="s2">&quot;Validated [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">())</span>
            <span class="n">cfn_result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="s2">&quot;Description  [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">cfn_result</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">cfn_params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;Parameters&#39;</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="s2">&quot;Parameters:&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">cfn_params</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">F</span> <span class="o">+</span> <span class="s2">&quot;Cannot validate </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_file</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.validate_yaml">
    <p>def <span class="ident">validate_yaml</span>(</p><p>self, yaml_file)</p>
    </div>




    <div class="desc"><p>This function validates the given yaml file.</p>
<p>:param yaml_file: Yaml file name</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.validate_yaml', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.validate_yaml" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">validate_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function validates the given yaml file.</span>
<span class="sd">    :param yaml_file: Yaml file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">run_tests</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">required_global_keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;qsname&#39;</span><span class="p">,</span>
        <span class="s1">&#39;owner&#39;</span><span class="p">,</span>
        <span class="s1">&#39;reporting&#39;</span><span class="p">,</span>
        <span class="s1">&#39;regions&#39;</span>
    <span class="p">]</span>
    <span class="n">required_test_parameters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;template_file&#39;</span><span class="p">,</span>
        <span class="s1">&#39;parameter_input&#39;</span>
    <span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; :Reading Config form: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">checkyaml</span><span class="p">:</span>
                <span class="n">cfg_yml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">checkyaml</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_global_keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;global:</span><span class="si">%s</span><span class="s2"> missing from &quot;</span> <span class="o">%</span> <span class="n">key</span> <span class="o">+</span> <span class="n">yaml_file</span><span class="p">)</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">run_tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">defined</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nametag</span> <span class="o">+</span> <span class="s2">&quot; |Queing test =&gt; </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">defined</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">parms</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">defined</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_test_parameters</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg_yml</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">defined</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="k">pass</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No key </span><span class="si">%s</span><span class="s2"> in test&quot;</span> <span class="o">%</span> <span class="n">key</span> <span class="o">+</span> <span class="n">defined</span><span class="p">)</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;While inspecting: &quot;</span> <span class="o">+</span> <span class="n">parms</span><span class="p">)</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;Cannot open [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">yaml_file</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">E</span> <span class="o">+</span> <span class="s2">&quot;config.yml [</span><span class="si">%s</span><span class="s2">] is not formatted well!!&quot;</span> <span class="o">%</span> <span class="n">yaml_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">D</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">run_tests</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.welcome">
    <p>def <span class="ident">welcome</span>(</p><p>self, prog_name=&#39;taskcat.io&#39;)</p>
    </div>




  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.welcome', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.welcome" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">welcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prog_name</span><span class="o">=</span><span class="s1">&#39;taskcat.io&#39;</span><span class="p">):</span>
    <span class="n">banner</span> <span class="o">=</span> <span class="n">pyfiglet</span><span class="o">.</span><span class="n">Figlet</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="n">banner</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">banner</span><span class="o">.</span><span class="n">renderText</span><span class="p">(</span><span class="n">prog_name</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;version </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">version</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>


  <div class="item">
    <div class="name def" id="taskcat.TaskCat.write_logs">
    <p>def <span class="ident">write_logs</span>(</p><p>self, stack_id, logpath)</p>
    </div>




    <div class="desc"><p>This function writes the event logs of the given stack and all the child stacks to a given file.
:param stack_id: Stack Id
:param logpath: Log file path
:return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-taskcat.TaskCat.write_logs', this);">Show source &equiv;</a></p>
  <div id="source-taskcat.TaskCat.write_logs" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_id</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function writes the event logs of the given stack and all the child stacks to a given file.</span>
<span class="sd">    :param stack_id: Stack Id</span>
<span class="sd">    :param logpath: Log file path</span>
<span class="sd">    :return: </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stackinfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_stack_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stack_id</span><span class="p">))</span>
    <span class="n">stackname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;stack_name&#39;</span><span class="p">])</span>
    <span class="n">region</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stackinfo</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
    <span class="c1"># Get stack resources</span>
    <span class="n">cfnlogs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cfnlogs</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfnlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ResourceStatus&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;CREATE_COMPLETE&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;ResourceStatusReason&#39;</span> <span class="ow">in</span> <span class="n">cfnlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">reason</span> <span class="o">=</span> <span class="n">cfnlogs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ResourceStatusReason&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reason</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;Stack launch was successful&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |StackName: &quot;</span> <span class="o">+</span> <span class="n">stackname</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |Region: &quot;</span> <span class="o">+</span> <span class="n">region</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |Logging to: &quot;</span> <span class="o">+</span> <span class="n">logpath</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> |Tested on: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, </span><span class="si">%d</span><span class="s2">. %B %Y %I:%M%p&quot;</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;------------------------------------------------------------------------------------------&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;ResourceStatusReason: &quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reason</span><span class="p">),</span> <span class="mi">85</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;==========================================================================================&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logpath</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log_output</span><span class="p">:</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Region: &quot;</span> <span class="o">+</span> <span class="n">region</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;StackName: &quot;</span> <span class="o">+</span> <span class="n">stackname</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ResourceStatusReason:  </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reason</span><span class="p">),</span> <span class="mi">85</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Events:  </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">cfnlogs</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">))</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*****************************************************************************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Tested on: &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, </span><span class="si">%d</span><span class="s2">. %B %Y %I:%M%p&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s2">&quot;-----------------------------------------------------------------------------</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">log_output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># Collect resources of the stack and get event logs for any child stacks</span>
    <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resources</span><span class="p">(</span><span class="n">stackname</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">include_stacks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">resource</span><span class="p">[</span><span class="s1">&#39;resourceType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AWS::CloudFormation::Stack&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_logs</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;physicalId&#39;</span><span class="p">],</span> <span class="n">logpath</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>

          <h3>Instance variables</h3>
            <div class="item">
            <p id="taskcat.TaskCat.banner" class="name">var <span class="ident">banner</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.capabilities" class="name">var <span class="ident">capabilities</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.config" class="name">var <span class="ident">config</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.defult_region" class="name">var <span class="ident">defult_region</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.interface" class="name">var <span class="ident">interface</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.nametag" class="name">var <span class="ident">nametag</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.parameter_path" class="name">var <span class="ident">parameter_path</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.project" class="name">var <span class="ident">project</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.run_cleanup" class="name">var <span class="ident">run_cleanup</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.s3bucket" class="name">var <span class="ident">s3bucket</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.template_path" class="name">var <span class="ident">template_path</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.test_region" class="name">var <span class="ident">test_region</span></p>




  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="taskcat.TaskCat.verbose" class="name">var <span class="ident">verbose</span></p>




  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>

<p></body>
</html></p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
